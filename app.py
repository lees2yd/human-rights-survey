import streamlit as st
import pandas as pd
from datetime import datetime
from zoneinfo import ZoneInfo
import gspread
from google.oauth2.service_account import Credentials
import streamlit.components.v1 as components

# âœ… PDF ìƒì„±ì„ ìœ„í•œ ì¶”ê°€ import
from io import BytesIO
from reportlab.lib.pagesizes import A4
from reportlab.pdfgen import canvas
from reportlab.lib.units import mm
from textwrap import wrap

import matplotlib.pyplot as plt
import numpy as np
from reportlab.lib.utils import ImageReader

# -------------------------------------------
# ğŸ“Œ matplotlib í•œê¸€ í°íŠ¸ ì„¤ì • (ë ˆì´ë” ì°¨íŠ¸ìš©)
# -------------------------------------------
from matplotlib import font_manager

font_path = "fonts/NanumGothicCoding.ttf"  # reportlabì—ì„œ ì“°ëŠ” ê²ƒê³¼ ë™ì¼ ê²½ë¡œ
font_manager.fontManager.addfont(font_path)
nanum_font = font_manager.FontProperties(fname=font_path)

plt.rcParams["font.family"] = nanum_font.get_name()
plt.rcParams["axes.unicode_minus"] = False

# -------------------------------------------
# ğŸ“Œ í•œê¸€ í°íŠ¸ ë“±ë¡ (NanumGothic)
# -------------------------------------------
from reportlab.pdfbase import pdfmetrics
from reportlab.pdfbase.ttfonts import TTFont

# âš ï¸ GitHubì— ì˜¬ë¦° ê²½ë¡œ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•´ì•¼ í•¨ (í˜„ì¬ í´ë” êµ¬ì¡° ê¸°ì¤€)
pdfmetrics.registerFont(TTFont("NanumGothic", "fonts/NanumGothicCoding.ttf"))

# âœ… ë°˜ë“œì‹œ ê°€ì¥ ë¨¼ì €
st.set_page_config(page_title="ê°Â·ìˆ˜Â·ì„± ì¸ê¶Œê°ìˆ˜ì„± ì„¤ë¬¸", layout="centered")

# âœ… ê·¸ ë‹¤ìŒ CSS
st.markdown("""
<style>
.progress-fixed{
    position: fixed;
    top: 3.25rem;
    left: 0;
    right: 0;
    z-index: 100000;
    background: white;
    padding: 12px 16px;
    border-bottom: 1px solid #e5e7eb;
}

.progress-wrap{
    width: 100%;
    height: 12px;
    background: #e5e7eb;
    border-radius: 999px;
    overflow: hidden;
}

.progress-bar{
    height: 100%;
    background: linear-gradient(90deg,#3b82f6,#2563eb);
    transition: width 0.3s ease;
}

.progress-text{
    margin-top: 6px;
    font-size: 0.9rem;
    text-align: right;
    color: #374151;
}

/* âœ… ì¶”ê°€: ì§„í–‰ë¥ ë°” ì•„ë˜ì— ëœ¨ëŠ” ê³ ì • ë©”ì‹œì§€ */
.progress-milestone{
    margin-top: 10px;
    padding: 10px 12px;
    border-radius: 12px;
    background: #f3f4f6;
    border: 1px solid #e5e7eb;
    font-size: 0.95rem;
    color: #111827;
}

/* âœ… ì¶”ê°€: ë©”ì‹œì§€ ìˆ¨ê¹€ */
.hidden{ display:none; }

.body-pad-top{
    padding-top: calc(110px + 3.25rem); /* ë©”ì‹œì§€ ê³µê°„ê¹Œì§€ ê³ ë ¤í•´ ì¡°ê¸ˆ ëŠ˜ë¦¼ */
}
</style>
""", unsafe_allow_html=True)

st.markdown("""
<style>

/* ===================================== */
/* 1) ì „ì²´ ë ˆì´ì•„ì›ƒ í­ & íŒ¨ë”©            */
/* ===================================== */

/* PCì—ì„œ ë‚´ìš© í­ì„ ë„ˆë¬´ ë„“ì§€ ì•Šê²Œ ì œí•œ */
[data-testid="stAppViewContainer"] > .main > div {
    max-width: 780px;
    margin: 0 auto;
}

/* ëª¨ë°”ì¼ì—ì„œ ì¢Œìš° íŒ¨ë”© ì¡°ê¸ˆ ì¤„ì´ê¸° */
@media (max-width: 480px) {
    .block-container {
        padding-left: 1rem !important;
        padding-right: 1rem !important;
    }
}

/* ===================================== */
/* 2) ì¼ë°˜ í…ìŠ¤íŠ¸(í‘œì§€/ë™ì˜/ê²°ê³¼) ì„¤ì •    */
/* ===================================== */

[data-testid="stMarkdownContainer"] p,
[data-testid="stMarkdownContainer"] li {
    word-break: keep-all;     /* í•œêµ­ì–´ ë‹¨ì–´ ì¤‘ê°„ ëŠê¹€ ë°©ì§€ */
    overflow-wrap: break-word;/* ë„ˆë¬´ ê¸´ ë‹¨ì–´ëŠ” ê°•ì œë¡œ ì¤„ë°”ê¿ˆ */
    line-height: 1.7;
    font-size: 1rem;
}

/* ì œëª©ì€ ì™¼ìª½ ì •ë ¬(í°ì—ì„œ ë” ìì—°ìŠ¤ëŸ¬ì›€) */
h1, h2, h3 {
    text-align: left !important;
}

/* ëª¨ë°”ì¼ì—ì„œëŠ” ê¸€ì ì‚´ì§ ì¤„ì´ê³  ì¤„ê°„ê²©ë„ ì‚´ì§ ì¤„ì„ */
@media (max-width: 480px) {
    [data-testid="stMarkdownContainer"] p,
    [data-testid="stMarkdownContainer"] li {
        font-size: 0.95rem;
        line-height: 1.6;
    }
}

/* ===================================== */
/* 3) ì§„í–‰ë¥ ë°” ëª¨ë°”ì¼ ê°„ê²© ì¡°ì •          */
/* ===================================== */

@media (max-width: 480px) {
    .progress-fixed{
        top: 2.8rem;
        padding: 8px 10px;
    }
    .body-pad-top{
        padding-top: calc(95px + 2.8rem);
    }
    .progress-text{
        font-size: 0.8rem;
    }
}

</style>
""", unsafe_allow_html=True)

st.caption("ê°.ìˆ˜.ì„± íŒë‹¨ì„¤ê³„ì—°êµ¬ì†Œ  |  ê°ì •Â·ê¸°ì¤€Â·ì„±ì°° ê¸°ë°˜ íŒë‹¨êµ¬ì¡° ì—°êµ¬")

# =======================================
# PC + Mobile ìë™ ìµœì í™” CSS
# =======================================
st.markdown("""
<style>

    /* ---- ë¬¸í•­ ì „ì²´ ë¸”ë¡ ---- */
    .question-block {
        margin-bottom: 26px;   /* ë¬¸í•­ ê°„ ì „ì²´ ê°„ê²© */
    }

    /* ---- ë¬¸í•­ í…ìŠ¤íŠ¸ ---- */
    .question-text {
        font-size: 1.05rem;
        font-weight: 500;
        margin-bottom: 4px;    /* ë¬¸í•­ê³¼ ì‘ë‹µ ì‚¬ì´ë¥¼ ì¢ê²Œ */
        line-height: 1.6;      /* ì¤„ê°„ê²© ì¡°ê¸ˆ ë„‰ë„‰í•˜ê²Œ */
        word-break: keep-all;  /* í•œêµ­ì–´ ë‹¨ì–´ ì¤‘ê°„ ëŠê¸° ë°©ì§€ */
    }

    /* ---- ë¼ë””ì˜¤ ë²„íŠ¼ ì‚¬ì´ ê°„ê²© ---- */
    .stRadio > div {
        margin-top: -2px !important;   /* ìœ„ìª½ ê°„ê²© ì¤„ì„ */
        margin-bottom: 6px !important; /* ì•„ë˜ìª½ì€ ê¸°ë³¸ ìœ ì§€ */
        display: flex !important;
        gap: 12px !important;
    }

    /* ---- ì‘ë‹µ ì•„ë˜ êµ¬ë¶„ì„  ---- */
    .answer-divider {
        border-bottom: 1px solid #dddddd;
        margin-top: 6px;
        margin-bottom: 12px;
    }

    /* ---- ëª¨ë°”ì¼ ìµœì í™” ---- */
    @media (max-width: 480px) {

        .question-text {
            font-size: 0.95rem !important;
            margin-bottom: 2px !important;
        }

        .stRadio > div {
            gap: 8px !important;
            margin-top: -6px !important;
        }

        .answer-divider {
            margin-top: 4px !important;
            margin-bottom: 10px !important;
        }
    }

</style>
""", unsafe_allow_html=True)

# =========================
# ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™”
# =========================
if "page" not in st.session_state:
    st.session_state.page = "cover"

if "answers" not in st.session_state:
    st.session_state.answers = {}

# =========================
# ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™”
# =========================
if "page" not in st.session_state:
    st.session_state.page = "cover"

if "answers" not in st.session_state:
    st.session_state.answers = {}

# =========================
# ğŸ“Œ ìƒë‹¨ ì§„í–‰ë¥  ë°” (ì„¤ë¬¸ + ì¸êµ¬í•™)
# =========================
TOTAL_SURVEY_Q = 27
TOTAL_DEMO_Q = 11

# ì¸êµ¬í•™ ë¬¸í•­ì— ì‚¬ìš©í•œ keyë“¤
DEMO_KEYS = [
    "age", "gender", "career", "jobtype", "facil",
    "shift", "edu_hr", "edu_mental", "exposure", "degree",
    "burnout_detach"
]

progress_pct = None
progress_label = ""

if st.session_state.page == "survey":
    # 27ë¬¸í•­ ì„¤ë¬¸ ì‘ë‹µ ê°œìˆ˜
    answered = sum(
        1 for i in range(1, TOTAL_SURVEY_Q + 1)
        if st.session_state.get(f"q_{i}") is not None
    )
    progress_pct = int((answered / TOTAL_SURVEY_Q) * 100)
    progress_label = f"{answered} / {TOTAL_SURVEY_Q} ë¬¸í•­ ì™„ë£Œ ({progress_pct}%)"

elif st.session_state.page == "demographic":
    # ì¸êµ¬í•™ 10ë¬¸í•­ ì‘ë‹µ ê°œìˆ˜
    answered = sum(
        1 for k in DEMO_KEYS
        if st.session_state.get(k) is not None
    )
    progress_pct = int((answered / TOTAL_DEMO_Q) * 100)
    progress_label = f"ì¸êµ¬í•™ ì •ë³´ {answered} / {TOTAL_DEMO_Q}ê°œ ì™„ë£Œ ({progress_pct}%)"

# ì‹¤ì œ ë Œë”ë§
if progress_pct is not None:
    st.markdown(f"""
    <div class="progress-fixed">
        <div class="progress-wrap">
            <div class="progress-bar" style="width:{max(progress_pct,1)}%"></div>
        </div>
        <div class="progress-text">
            {progress_label}
        </div>
    </div>
    <div class="body-pad-top"></div>
    """, unsafe_allow_html=True)
else:
    # í‘œì§€/ë™ì˜/ê²°ê³¼ í˜ì´ì§€ ë“±ì—ì„œëŠ” ì§„í–‰ë°” ì—†ì´ ì—¬ë°±ë§Œ
    st.markdown('<div class="body-pad-top"></div>', unsafe_allow_html=True)
    
# =========================
# ë¬¸í•­
# =========================
QUESTIONS = [
    "ìˆ˜ìš©ìê°€ ì†Œë€ì„ í”¼ìš¸ ë•Œ, ê·¸ ì•ˆì— ë‘ë ¤ì›€ì´ë‚˜ ë¶ˆì•ˆì´ ìˆì„ ìˆ˜ ìˆë‹¤ê³  ìƒê°í•œë‹¤.",   #1
    "ìˆ˜ìš©ìì˜ ë§íˆ¬ë‚˜ í‘œì •ì„ ë³´ë©° í™”ë‚¨, ìŠ¬í””, ê±±ì • ê°™ì€ ê°ì •ì„ ì‰½ê²Œ ë– ì˜¬ë¦°ë‹¤.",           #2
    "ìˆ˜ìš©ìì˜ ê°ì •ì„ ë‹¨ì •í•˜ì§€ ì•Šê³ , ëŒ€í™”ë‚˜ ê´€ì°°ë¡œ ë‹¤ì‹œ í™•ì¸í•˜ë ¤ í•œë‹¤.",                 #3
    "ìˆ˜ìš©ìì™€ ë§ˆì£¼í•  ë•Œ ë‚´ ê°ì •ì´ ì–´ë– í–ˆëŠ”ì§€ ì•Œì•„ë³¸ë‹¤.",                               #4
    "ë‚´ ê°ì •ì´ ë‹¨ìˆœí•œ ê¸°ë¶„ì´ ì•„ë‹ˆë¼ ê·¸ ê°ì •ì•ˆì— ë‚´ê°€ ì›í•˜ëŠ” ìš•êµ¬(ì•ˆì „, ì¡´ì¤‘ ë“±)ê°€ ìˆìŒì„ ì•Œì•„ì°¨ë¦°ë‹¤.",                      #5
    "ìˆ˜ìš©ìì˜ ê°ì •ì„ ì´í•´í•˜ë ¤ëŠ” ë…¸ë ¥ ìì²´ê°€ ë‚´ ê³µê°ëŠ¥ë ¥ì„ í‚¤ìš´ë‹¤ê³  ë³¸ë‹¤.",              #6
    "ì •ì‹ ê±´ê°• ë¬¸ì œ ìˆëŠ” ìˆ˜ìš©ìì˜ ê³¼ë„í•œ ë°˜ì‘ì´ í™˜ì²­ì´ë‚˜ ë¶ˆì•ˆ ë“± ë‹¤ì–‘í•œ ì‹¬ë¦¬ì  ë¬¸ì œ ë•Œë¬¸ì¼ ìˆ˜ ìˆëŠ”ì§€ ë¨¼ì € ì‚´í•€ë‹¤.",   #7
    "ì •ì‹ ê±´ê°• ë¬¸ì œ ìˆëŠ” ìˆ˜ìš©ìê°€ í¥ë¶„í•œ ê²½ìš°, ì§€ì‹œë¥¼ ê°„ë‹¨íˆ í•˜ê³  ì§§ê²Œ ë§í•œë‹¤.",         #8
    "ì •ì‹ ë¬¸ì œ ìˆëŠ” ìˆ˜ìš©ìì—ê²Œ ë¶ˆë¹›Â·ì†Œë¦¬Â·ì ‘ì´‰ ë“±ì´ ê´´ë¡œìš´ ìê·¹ì¼ ìˆ˜ ìˆìŒì„ ì´í•´í•œë‹¤.",   #9
    "ë‚´ê°€ ìˆ˜ìš©ìì— ëŒ€í•´ì—¬ í•˜ë ¤ëŠ” í–‰ë™ì´ ë‹¨ìˆœíˆ ê°ì • ë°°ì¶œì¸ì§€, ì•„ë‹ˆë©´ ì—…ë¬´ì— ê¼­ í•„ìš”í•œ ê²ƒì¸ì§€ êµ¬ë¶„í•œë‹¤.",                          #10
    "ë‚˜ì˜ ê°ì •ì´ ì£¼ëŠ” ì •ë³´ë¥¼ ì¸ì‹í•˜ê³  ê·¸ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ í–‰ë™í•œë‹¤.",                      #11
    "ë‚˜ëŠ” í¸ë¦¬í•¨ì„ í¬ê¸°í•˜ë”ë¼ë„ ê·œì •ì„ ì§€í‚¤ë ¤ê³  ì˜ì‹ì ìœ¼ë¡œ ë…¸ë ¥í•œë‹¤.",                           #12
    "ë‚´ê°€ ì·¨í•˜ëŠ” ì¡°ì¹˜ê°€ ëª©ì ì— ë§ìœ¼ë©°, ê¼­ í•„ìš”í•œ ì •ë„ì¸ì§€ ë¨¼ì € ì‚´í•€ë‹¤.",                            #13
    "ìˆ˜ìš©ìì—ê²Œ ì¡°ì¹˜ë¥¼ í•  ë•Œ ë°˜ë“œì‹œ ì •í•´ì§„ ì ˆì°¨ë¥¼ ë”°ë¥¸ë‹¤.",                           #14
    "ìˆ˜ìš©ìì— ëŒ€í•œ ëŒ€ì‘ì€ ì–¸ì œë‚˜ í—Œë²• ê¸°ì¤€(ì˜ˆ: ëª©ì ì˜ ì •ë‹¹ì„±, ìˆ˜ë‹¨ì˜ ì í•©ì„±, ê·¸ë¦¬ê³  ì¹¨í•´ì˜ ìµœì†Œì„± ë“±)ì— ë§ê²Œ ì¡°ì •í•œë‹¤.",                    #15
    "ì •ì‹ ê±´ê°• ë¬¸ì œê°€ ìˆëŠ” ìˆ˜ìš©ìì˜ ìí•´ ë“± ìœ„í—˜ ì‹ í˜¸ê°€ ë³´ì´ë©´ ì •í•´ì§„ ì ˆì°¨ì— ë”°ë¼ ì¡°ì¹˜í•œë‹¤.",           #16
    "ì •ì‹ ê±´ê°• ë¬¸ì œê°€ ìˆëŠ” ìˆ˜ìš©ìì—ê²Œ ë¬¸ì œ(ì˜ˆ,í™˜ì²­ ë¶ˆì•ˆ ë“±) ìƒí™© ë°œìƒì‹œ ì˜ë£ŒÂ·ì‹¬ë¦¬ ì „ë¬¸ê°€ì™€ ìƒì˜í•´ ëŒ€ì‘ì„ ì¡°ì •í•œë‹¤.",                    #17
    "ì •ì‹ ê±´ê°• ë¬¸ì œê°€ ìˆëŠ” ìˆ˜ìš©ìì— ëŒ€í•œ ëŒ€ì‘ë°©ì‹ì´ ê·¸ë“¤ì˜ ì •ì‹ ìƒíƒœì— ì í•©í•œ ì¡°ì¹˜ì¸ì§€ ê³ ë ¤í•´ì„œ ê²°ì •í•œë‹¤.",                                        #18
    "ìˆ˜ìš©ìë¥¼ ëŒ€í•  ë•Œ, ë‚˜ì˜ í¸ê²¬ìœ¼ë¡œ ì¸í•´ ë°˜ì‘ì´ ë‹¬ë¼ì§€ì§„ ì•Šì•˜ëŠ”ì§€ ë‹¤ì‹œ ìƒê°í•´ ë³¸ë‹¤.",                       #19
    "ë‚˜ëŠ” ìˆ˜ìš©ìë¥¼ ì§‘ë‹¨ì´ ì•„ë‹Œ ê°œì¸ìœ¼ë¡œ ì´í•´í•˜ë ¤ ë…¸ë ¥í•œë‹¤.",                          #20
    "ë‚˜ ìì‹  ìŠ¤ìŠ¤ë¡œì˜ íŒë‹¨ë³´ë‹¤ëŠ” ë™ë£Œë“¤ì˜ ì••ë ¥ì— ë”°ë¼ í–‰ë™í•œ ì ì´ ì—†ëŠ”ì§€ ì ê²€í•œë‹¤.",                                   #21
    "ë‚˜ëŠ” ê¶Œìœ„ì— íœ˜ë‘˜ë¦¬ì§€ ì•Šë„ë¡ ë‚´ê°€ íŒë‹¨í•œ ëŒ€ë¡œ í–‰ë™í•˜ê³ ì ë…¸ë ¥í•œë‹¤.",                               #22
    "ê³¼ê±°ì™€ ë¹„êµí•´ ë³¼ ë•Œë©´ ë‚˜ì˜ ì—…ë¬´ ìŠµê´€ì´ ë‹¬ë¼ì¡Œë‹¤ê³  ëŠë‚€ë‹¤.",                                   #23
    "ë‚´ê°€ ëŠë‚€ ê°ì •ì´ ì‹¤ì œ ìƒí™© ë•Œë¬¸ì´ ì•„ë‹ˆë¼, ë‚´ í”¼ë¡œë‚˜ ìŠ¤íŠ¸ë ˆìŠ¤ë¡œ ì¸í•´ ê³¼ì¥ëœ ê²ƒì¼ ìˆ˜ë„ ìˆë‹¤ê³  ìƒê°í•œë‹¤.",                     #24
    "ì •ì‹ ì§ˆí™˜ ë“±ì„ ì´ìœ ë¡œ ì •ì‹ ê±´ê°• ë¬¸ì œê°€ ìˆëŠ” ìˆ˜ìš©ìë¥¼ ì¼ë°˜ ìˆ˜ìš©ìë“¤ê³¼ êµ¬ë¶„í•˜ì§€ ì•Šê³  ëŒ€í•˜ë ¤ê³  í•œë‹¤.",                            #25
    "ë™ë£Œë“¤ì˜ íƒœë„ì— íœ©ì“¸ë ¤ ì •ì‹ ê±´ê°• ë¬¸ì œê°€ ìˆëŠ” ìˆ˜ìš©ìì—ê²Œ ë” ê°•í•˜ê²Œ ëŒ€í•˜ì§€ ì•Šì•˜ëŠ”ì§€ë¥¼ ëŒì•„ë³¸ë‹¤.",                                #26
    "ë‚˜ëŠ” ì •ì‹ ê±´ê°• ë¬¸ì œê°€ ìˆëŠ” ìˆ˜ìš©ìë¥¼ ë¬¸ì œ ìˆ˜ìš©ìë¡œ ë‹¨ì •í•˜ì§€ ì•Šìœ¼ë ¤ê³  í•œë‹¤."                          #27
]

# =========================
# ìƒˆ í”¼ë“œë°± ë¡œì§ (ì €Â·ì¤‘Â·ê³  + íŒ¨í„´)
# =========================

# ì ìˆ˜ â†’ ìˆ˜ì¤€(label) ë§¤í•‘ìš©
LEVEL_LABEL_KO = {
    "low": "ë‚®ì€",
    "mid": "ì¤‘ê°„",
    "high": "ë†’ì€",
}

def overall_level(total: int) -> str:
    """
    ì „ì²´ ì´ì  â†’ ì €/ì¤‘/ê³  êµ¬ë¶„
    - 27ë¬¸í•­, 1~4ì  â†’ 27~108ì 
    - ê¸°ì¡´ í•´ì„(<=67, <=87, >87)ì„ 3ë‹¨ê³„ë¡œ ë‹¨ìˆœí™”
    """
    if total <= 67:
        return "low"
    elif total <= 87:
        return "mid"
    else:
        return "high"

def subfactor_level(score: int) -> str:
    """
    ê°/ìˆ˜/ì„± ê°ê° 9ë¬¸í•­(9~36ì ) â†’ ì €/ì¤‘/ê³ 
    ê¸°ì¡´ ì„ê³„ê°’:
      - 28ì  ì´ìƒ: ê³ 
      - 19~27ì : ì¤‘
      - 18ì  ì´í•˜: ì €
    """
    if score >= 28:
        return "high"
    elif score >= 19:
        return "mid"
    else:
        return "low"

def mental_level(score: int) -> str:
    """
    ì •ì‹ ì§ˆí™˜ ê´€ë ¨ 9ë¬¸í•­(9~36ì ) â†’ ì €/ì¤‘/ê³ 
    ê¸°ì¡´ ì„ê³„ê°’:
      - 27ì  ì´ìƒ: ê³ 
      - 20~26ì : ì¤‘
      - 19ì  ì´í•˜: ì €
    """
    if score >= 27:
        return "high"
    elif score >= 20:
        return "mid"
    else:
        return "low"

# -------------------------
# í…ìŠ¤íŠ¸ ë³¸ë¬¸: ì „ì²´ ì¸ê¶Œê°ìˆ˜ì„±
# -------------------------

OVERALL_TEXT = {
    "low": '''**ì „ì²´ ì¸ê¶Œê°ìˆ˜ì„± â€“ ì €(ä½)**  

**í•œ ì¤„ ìš”ì•½**  
â€œì „ì²´ ê°Â·ìˆ˜Â·ì„± ì§€ìˆ˜ê°€ ìƒëŒ€ì ìœ¼ë¡œ ë‚®ì€ í¸ì…ë‹ˆë‹¤.  
ì§€ê¸ˆì˜ ê·¼ë¬´ ì¡°ê±´ì—ì„œ ê°ì •â€“ê¸°ì¤€â€“ì„±ì°°ì„ ëª¨ë‘ ì±™ê¸°ê¸° ì–´ë ¤ì› ë‹¤ëŠ” ì‹ í˜¸ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.â€

**ì™œ ì´ë ‡ê²Œ ë‚˜ì˜¬ ìˆ˜ ìˆë‚˜?**  
â€¢ êµëŒ€ê·¼ë¬´, ì¸ë ¥ ë¶€ì¡±, ì‚¬ê±´ ìŠ¤íŠ¸ë ˆìŠ¤ ë“±ìœ¼ë¡œ **â€˜ì¼ë‹¨ ì‚¬ê³  ì—†ì´ ë„˜ê¸°ëŠ” ê²ƒâ€™** ì´ ìµœìš°ì„ ì´ ë˜ëŠ” ìƒí™©ì´ ë§ì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
â€¢ ê°ì •Â·ê¸°ì¤€Â·ì„±ì°°ì´ ì—†ì–´ì„œê°€ ì•„ë‹ˆë¼, ëŒë ¤ ì“¸ ìˆ˜ ìˆëŠ” ì—¬ìœ ì™€ ì—ë„ˆì§€ê°€ ë¶€ì¡±í•œ í™˜ê²½ì´ ì ìˆ˜ì— ë°˜ì˜ë˜ì—ˆì„ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤.

**í˜„ì¥ ì˜ˆì‹œ**  
â€¢ ì•¼ê°„ì— í˜¸ì¶œì´ ì—¬ëŸ¬ ë²ˆ ê²¹ì³, â€œì™œ ì €ëŸ´ê¹Œ?â€ë¥¼ ìƒê°í•˜ê¸°ë„ ì „ì— ë¨¼ì € ì§„ì •ì‹œí‚¤ê³  ìƒí™© ì •ë¦¬ë¶€í„° í–ˆë˜ ì¥ë©´ë“¤ì´ ë°˜ë³µë˜ì—ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
â€¢ ê·œì •ì´ë‚˜ ì ˆì°¨ë¥¼ ë– ì˜¬ë¦¬ê¸´ í–ˆì§€ë§Œ, â€œì§€ê¸ˆì€ ê·¸ëƒ¥ ë¹¨ë¦¬ ì²˜ë¦¬í•´ì•¼ í•œë‹¤â€ê³  ëŠê»´ ë§ˆìŒì† ê¸°ì¤€ê³¼ ì‹¤ì œ í–‰ë™ ì‚¬ì´ì— ê°„ê²©ì„ ëŠê¼ˆì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

**ë‹¤ìŒ í•œ ê±¸ìŒ ì œì•ˆ**  
â€¢ ì´ ì ìˆ˜ëŠ” â€œë‚´ê°€ ë¶€ì¡±í•˜ë‹¤â€ëŠ” íŒì •ì´ ì•„ë‹ˆë¼, **â€œì§€ê¸ˆ ì¡°ê±´ì—ì„œ ì´ ì •ë„ê°€ í•œê³„ì˜€ì„ ìˆ˜ë„ ìˆë‹¤â€** ëŠ” í˜„ì‹¤ì„ ë³´ì—¬ì£¼ëŠ” ì§€ë„ì…ë‹ˆë‹¤.  
â€¢ ì•ìœ¼ë¡œëŠ” ëª¨ë“  ê±¸ í•œ ë²ˆì— ë°”ê¾¸ê¸°ë³´ë‹¤, í•˜ë£¨ì— í•œ ì¥ë©´ë§Œ ë– ì˜¬ë¦¬ë©° â€œê·¸ë•Œ ê°ì •Â·ê¸°ì¤€Â·ì„±ì°° ì¤‘ ë¬´ì—‡ì„ ê°€ì¥ ì±™ê¸°ê¸° ì–´ë ¤ì› ë‚˜?â€ë¥¼ ì§šì–´ë³´ëŠ” ê²ƒë¶€í„° ì‹œì‘í•´ë„ ì¶©ë¶„í•©ë‹ˆë‹¤.''',

    "mid": '''**ì „ì²´ ì¸ê¶Œê°ìˆ˜ì„± â€“ ì¤‘(ä¸­)**  

**í•œ ì¤„ ìš”ì•½**  
â€œì „ì²´ ê°Â·ìˆ˜Â·ì„± ì§€ìˆ˜ê°€ ì¤‘ê°„ ìˆ˜ì¤€ì…ë‹ˆë‹¤.  
ìƒí™©ì— ë”°ë¼ ì˜ ì‘ë™í•˜ê¸°ë„ í•˜ê³ , í”ë“¤ë¦¬ê¸°ë„ í•˜ëŠ” ìì—°ìŠ¤ëŸ¬ìš´ ì–‘ìƒì…ë‹ˆë‹¤.â€

**ì™œ ì´ë ‡ê²Œ ë‚˜ì˜¬ ìˆ˜ ìˆë‚˜?**  
â€¢ í‰ìƒì‹œì—ëŠ” ê°ì •â€“ê¸°ì¤€â€“ì„±ì°°ì´ ì–´ëŠ ì •ë„ ì—°ê²°ë˜ì§€ë§Œ, ê·¼ë¬´ ê°•ë„ë‚˜ ì‚¬ê±´ì˜ í¬ê¸°ì— ë”°ë¼ í•œë‘ ë¶€ë¶„ì´ ëŠê¸°ëŠ” ìˆœê°„ì´ ìˆì—ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
â€¢ ì¸ê¶Œì´ ê¸´ì¥ë˜ëŠ” ìƒí™©ì—ì„œë„ â€œì´ë ‡ê²Œ í•˜ëŠ” ê²Œ ë§ë‚˜?â€ë¥¼ ë– ì˜¬ë ¤ ë³¸ ê²½í—˜ì´ ìˆì§€ë§Œ, ë§¤ë²ˆ ê·¸ë ‡ê²Œ í•˜ê¸°ì—ëŠ” ì—ë„ˆì§€ê°€ ë¶€ì¡±í–ˆì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

**í˜„ì¥ ì˜ˆì‹œ**  
â€¢ ë‚® ê·¼ë¬´, ë¹„êµì  ì—¬ìœ  ìˆëŠ” ìƒí™©ì—ì„œëŠ” ìˆ˜ìš©ì ë§ì„ ëê¹Œì§€ ë“¤ì–´ì£¼ê³ , ê·œì •ì— ë§ëŠ” ì„ íƒì§€ë¥¼ ì°¾ìœ¼ë ¤ í–ˆë˜ ê²½í—˜ì´ ìˆìŠµë‹ˆë‹¤.  
â€¢ ë°˜ëŒ€ë¡œ ì¸ë ¥ ë¶€ì¡±ì´ë‚˜ ê²©í•œ ìƒí™©ì—ì„œëŠ” â€œì›ë˜ë¼ë©´ ì´ë ‡ê²Œ í–ˆì–´ì•¼ í•˜ëŠ”ë°â€¦â€ë¼ëŠ” ìƒê°ë§Œ ë‚¨ê³ , ê·¸ëŒ€ë¡œ ì‹¤ì²œí•˜ê¸´ ì–´ë ¤ì› ë˜ ê¸°ì–µë„ í•¨ê»˜ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ë‹¤ìŒ í•œ ê±¸ìŒ ì œì•ˆ**  
â€¢ ì´ë¯¸ ê½¤ ë‹¨ë‹¨í•œ ê¸°ë°˜ì„ ê°€ì§„ ìƒíƒœì…ë‹ˆë‹¤.  
â€¢ íŠ¹íˆ ì•¼ê°„, ì¸ë ¥ ë¶€ì¡±, ì •ì‹ ì§ˆí™˜ ìˆ˜ìš©ì ëŒ€ì‘ ê°™ì€ â€œë‚´ê°€ ê°€ì¥ ë²„ê±°ì› ë˜ ìƒí™©â€ì„ ë– ì˜¬ë ¤, ê·¸ë•Œ ê°ì •â€“ê¸°ì¤€â€“ì„±ì°° ì¤‘ ì–´ë””ì„œ ê°€ì¥ ìì£¼ ëŠê¸°ëŠ”ì§€ë¥¼ ì‚´í´ë³´ë©´ ì‹¤ì²œ êµ¬ì¡°ë¥¼ í•œ ë‹¨ê³„ ë” ê²¬ê³ í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.''',

    "high": '''**ì „ì²´ ì¸ê¶Œê°ìˆ˜ì„± â€“ ê³ (é«˜)**  

**í•œ ì¤„ ìš”ì•½**  
â€œì „ì²´ ê°Â·ìˆ˜Â·ì„± ì§€ìˆ˜ê°€ ë¹„êµì  ë†’ì€ ìˆ˜ì¤€ì…ë‹ˆë‹¤.  
ì¸ê¶Œì´ ê±¸ë¦° ìƒí™©ì—ì„œë„ ê°ì •â€“ê¸°ì¤€â€“ì„±ì°°ì„ í•¨ê»˜ ë– ì˜¬ë¦¬ë ¤ëŠ” ìŠµê´€ì´ ìë¦¬ ì¡ì•„ ìˆëŠ” ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.â€

**ì™œ ì´ë ‡ê²Œ ë‚˜ì˜¬ ìˆ˜ ìˆë‚˜?**  
â€¢ ì‚¬ê±´ì´ ìƒê¸°ë©´,  
  1. ìƒí™©ê³¼ ê°ì •ì„ ë³´ê³   
  2. ê·œì •Â·í—Œë²• ê¸°ì¤€ì„ ë– ì˜¬ë¦° ë’¤  
  3. ë‚˜ì˜ ëŒ€ì‘ì„ ì§§ê²Œ ëŒì•„ë³´ëŠ” ê³¼ì •ì´ ë°˜ë³µë˜ì–´ ì˜¨ ê²°ê³¼ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
â€¢ ê°ì •ë§Œ ë³´ê±°ë‚˜ ê·œì •ë§Œ ë³´ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, **â€œì‚¬ëŒ + ê¸°ì¤€ + ë‚˜ì˜ ë°˜ì‘â€** ì„ ì—°ê²°í•´ì„œ ìƒê°í•˜ë ¤ëŠ” íƒœë„ê°€ ì´ë¯¸ í˜•ì„±ëœ ë‹¨ê³„ì…ë‹ˆë‹¤.

**í˜„ì¥ ì˜ˆì‹œ**  
â€¢ ìˆ˜ìš©ìê°€ ê²©ì•™ëœ ìƒí™©ì—ì„œë„, â€œì§€ê¸ˆ ì´ ì¡°ì¹˜ê°€ ì •ë§ í•„ìš”í•œê°€? ë” ì¤„ì¼ ë°©ë²•ì€ ì—†ë‚˜?â€ë¥¼ í•œ ë²ˆ ë” ì ê²€í•´ ë³¸ ê²½í—˜ì´ ìì£¼ ë– ì˜¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
â€¢ ì¡°ì¹˜ í›„ì—ë„ â€œë‹¤ìŒì—ëŠ” ì´ë ‡ê²Œ ë§í•´ë³´ì, ì´ ì •ë„ê¹Œì§€ë§Œ ì œì¬í•´ë„ ë˜ì§€ ì•Šì„ê¹Œ?â€ë¥¼ ìŠ¤ìŠ¤ë¡œ ì •ë¦¬í•´ ë³¸ ì ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ë‹¤ìŒ í•œ ê±¸ìŒ ì œì•ˆ**  
â€¢ ì ìˆ˜ê°€ ë†’ë‹¤ê³  í•´ì„œ í•­ìƒ ì™„ë²½í–ˆë‹¤ëŠ” ëœ»ì€ ì•„ë‹™ë‹ˆë‹¤.  
â€¢ ì´ ë‹¨ê³„ì˜ ê³¼ì œëŠ” ì´ë¯¸ í˜•ì„±ëœ ê°•ì ì„ ì§€í‚¤ë©´ì„œ ì†Œì§„ì„ ì˜ˆë°©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.  
â€¢ ë™ë£Œì™€ ê²½í—˜ì„ ë‚˜ëˆ„ê¸°, í•„ìš”í•  ë•Œ ë„ì›€ ìš”ì²­í•˜ê¸°, íœ´ì‹Â·ìƒë‹´ ìì› í™œìš©í•˜ê¸° ë“±ì„ í†µí•´, ì§€ê¸ˆì˜ êµ¬ì¡°ê°€ ë¬´ë„ˆì§€ì§€ ì•Šë„ë¡ ì—ë„ˆì§€ë¥¼ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.'''
}

# -------------------------
# í…ìŠ¤íŠ¸ ë³¸ë¬¸: ê°(æ„Ÿ) â€“ ê°ì • ì¸ì‹
# -------------------------

EMOTION_TEXT = {
    "low": '''**ê°(æ„Ÿ) â€“ ì €(ä½)**  

**í•œ ì¤„ ìš”ì•½**  
â€œê°(ê°ì • ì¸ì‹) ì ìˆ˜ê°€ ìƒëŒ€ì ìœ¼ë¡œ ë‚®ì€ í¸ì…ë‹ˆë‹¤.  
ì‚¬ëŒì˜ ê°ì •ë³´ë‹¤ â€˜ì‚¬ê±´ ì²˜ë¦¬â€™ê°€ ë¨¼ì €ì¼ ìˆ˜ë°–ì— ì—†ëŠ” í™˜ê²½ì´ ì˜¤ë˜ ì´ì–´ì¡Œë‹¤ëŠ” ì‹ í˜¸ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.â€

**ì™œ ì´ë ‡ê²Œ ë‚˜ì˜¬ ìˆ˜ ìˆë‚˜?**  
â€¢ í˜¸ì¶œÂ·ë³´ê³ Â·ì„œë¥˜ ë“± ì²˜ë¦¬í•´ì•¼ í•  ì¼ì´ ë§ì•„ **â€˜ì§€ê¸ˆ ì´ ì‚¬ëŒì€ ì–´ë–¤ ê°ì •ì¼ê¹Œ?â€™ë¥¼ ìƒê°í•˜ê¸°ë³´ë‹¤, â€˜ì¼ë‹¨ ì§„ì •ì‹œí‚¤ê³  ì²˜ë¦¬í•´ì•¼ í•œë‹¤â€™** ëŠ” ë§ˆìŒì´ ì•ì„¤ ìˆ˜ë°–ì— ì—†ìŠµë‹ˆë‹¤.  
â€¢ ì´ëŠ” ê°ì •ì— ê´€ì‹¬ì´ ì—†ì–´ì„œê°€ ì•„ë‹ˆë¼, **â€œë²„í‹°ê¸° ìœ„í•œ ìƒì¡´ ë°©ì‹â€** ìœ¼ë¡œ ê°ì • ì¸ì‹ì„ ë’¤ë¡œ ë°€ì–´ ë‘” ê²°ê³¼ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**í˜„ì¥ ì˜ˆì‹œ**  
â€¢ ë¯¼ì›ì´ë‚˜ ìš”êµ¬ê°€ ë°˜ë³µë˜ëŠ” ìˆ˜ìš©ìì—ê²Œ â€œë˜ ì‹œì‘ì´ë„¤â€ë¼ëŠ” ìƒê°ì´ ë¨¼ì € ë– ì˜¤ë¥´ê³ , ê·¸ ë’¤ì˜ ë¶ˆì•ˆÂ·ì™¸ë¡œì›€Â·ìˆ˜ì¹˜ì‹¬ ê°™ì€ ê°ì •ì€ ë‚˜ì¤‘ì—ì•¼ ë– ì˜¬ëë˜ ê²½í—˜ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
â€¢ ë‚˜ ìì‹ ì˜ í”¼ë¡œ, ì§œì¦, ë¬´ë ¥ê°ë„ ëŠë¼ì§€ë§Œ, â€œì´ê±¸ ëŠë¼ê³  ìˆìœ¼ë©´ ë²„í‹°ê¸° í˜ë“¤ë‹¤â€ê³  ìƒê°í•´ ì¼ë‹¨ ë®ì–´ë‘ê³  ë„˜ì–´ê°€ëŠ” íŒ¨í„´ì´ ìƒê²¼ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ë‹¤ìŒ í•œ ê±¸ìŒ ì œì•ˆ**  
â€¢ ì´ ì ìˆ˜ëŒ€ì˜ ê³¼ì œëŠ” ìƒˆë¡œìš´ ê°ì •ì„ ë§Œë“¤ì–´ë‚´ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ì´ë¯¸ ëŠë¼ê³  ìˆì—ˆì§€ë§Œ ë§ë¡œ ë¶™ì´ì§€ ëª»í•œ ê°ì •ì„ í•˜ë£¨ì— í•œ ë²ˆë§Œ ì§§ê²Œ í™•ì¸í•´ ë³´ëŠ” ê²ƒì…ë‹ˆë‹¤.  
â€¢ â€œì˜¤ëŠ˜ ê°€ì¥ í˜ë“¤ì—ˆë˜ ìˆœê°„, ë‚˜ëŠ” ì–´ë–¤ ê°ì •ì´ì—ˆë‚˜?â€ (ì˜ˆ: ë‹µë‹µí•¨, ì–µìš¸í•¨, ë¶€ë‹´ê°, í”¼ë¡œ)  
ì´ë ‡ê²Œ ê°ì •ì— ì´ë¦„ì„ ë¶™ì´ëŠ” ì‘ì€ ì—°ìŠµë§Œìœ¼ë¡œë„ ê°(æ„Ÿ) ì˜ì—­ì€ ì¶©ë¶„íˆ íšŒë³µë˜ê¸° ì‹œì‘í•©ë‹ˆë‹¤.''',

    "mid": '''**ê°(æ„Ÿ) â€“ ì¤‘(ä¸­)**  

**í•œ ì¤„ ìš”ì•½**  
â€œê°(ê°ì • ì¸ì‹) ì ìˆ˜ê°€ ì¤‘ê°„ ìˆ˜ì¤€ì…ë‹ˆë‹¤.  
ìƒëŒ€ë°© ê°ì •ì„ ì½ì–´ë‚´ëŠ” í˜ì€ ìˆìœ¼ë‚˜, ê¸‰í•  ë•ŒëŠ” í–‰ë™ì´ ë¨¼ì € ë‚˜ê°ˆ ìˆ˜ ìˆëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤.â€

**ì™œ ì´ë ‡ê²Œ ë‚˜ì˜¬ ìˆ˜ ìˆë‚˜?**  
â€¢ ì—¬ìœ ê°€ ìˆì„ ë•ŒëŠ” í‘œì •Â·ë§íˆ¬Â·ë¶„ìœ„ê¸°ì—ì„œ ìƒëŒ€ë°© ê°ì •ì„ ì–´ëŠ ì •ë„ íŒŒì•…í•´ ì™”ìŠµë‹ˆë‹¤.  
â€¢ ë‹¤ë§Œ, ì‹œê°„ì— ì«“ê¸°ê±°ë‚˜ ì‚¬ê±´ì´ ê²¹ì¹  ë•Œì—ëŠ” â€œëŠë¼ê¸° ì „ì— ë¨¼ì € ì›€ì§ì—¬ì•¼ í•œë‹¤â€ëŠ” ìƒê° ë•Œë¬¸ì— ê°ì • ì½ê¸°ê°€ ë’¤ë¡œ ë°€ë ¸ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**í˜„ì¥ ì˜ˆì‹œ**  
â€¢ ì´ˆê¸° ë©´ë‹´ì´ë‚˜ ëŒ€í™”ì—ì„œëŠ” â€œì´ ì‚¬ëŒì€ ì¢€ ìœ„ì¶•ë¼ ìˆêµ¬ë‚˜, ë§ì´ ë¶ˆì•ˆí•´ ë³´ì´ë„¤â€ ê°™ì€ ëŠë‚Œì„ ë°›ì•˜ë˜ ê²½í—˜ì´ ìˆìŠµë‹ˆë‹¤.  
â€¢ ê·¸ëŸ¬ë‚˜ í˜¸ì†¡, ì…ì†Œ, ì§‘ë‹¨ ìƒí™©ì²˜ëŸ¼ ì†ë„ê°€ ì¤‘ìš”í•œ ì¥ë©´ì—ì„œëŠ” ê·¸ëŸ° ê°ì • ì‹ í˜¸ë¥¼ ì¡ê¸° ì „ì— ì ˆì°¨ì™€ í†µì œê°€ ìš°ì„ ë˜ì—ˆë˜ ê²½ìš°ê°€ ìˆì—ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ë‹¤ìŒ í•œ ê±¸ìŒ ì œì•ˆ**  
â€¢ â€œëª¨ë“  ìƒí™©ì—ì„œ ë‹¤ ê³µê°í•´ì•¼ í•œë‹¤â€ê°€ ëª©í‘œì¼ í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤.  
â€¢ ëŒ€ì‹ , ìœ„í—˜ ì§•í›„ë‚˜ ê¸´ì¥ ìƒí™©ì—ì„œë§Œì´ë¼ë„  
  â€¢ â€œì§€ê¸ˆ ì´ ì‚¬ëŒì€ ì–´ë–¤ ê°ì •ì¼ê¹Œ?â€  
  â€¢ â€œë‚´ ê°ì •ì€ ì–´ë–¤ê°€?â€  
  ë¥¼ í•œ ë²ˆ ë– ì˜¬ë ¤ ë³´ëŠ” ìŠµê´€ì´ ìƒê¸°ë©´, ì´ë¯¸ ìˆëŠ” ê°ì • ì¸ì‹ ëŠ¥ë ¥ì´ í›¨ì”¬ ìì£¼, ì•ˆì •ì ìœ¼ë¡œ ì‘ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.''',

    "high": '''**ê°(æ„Ÿ) â€“ ê³ (é«˜)**  

**í•œ ì¤„ ìš”ì•½**  
â€œê°(ê°ì • ì¸ì‹) ì ìˆ˜ê°€ ë†’ì€ í¸ì…ë‹ˆë‹¤.  
ì‚¬ê±´ ì´ë©´ì— ìˆëŠ” â€˜ì‚¬ëŒì˜ ìƒíƒœâ€™ë¥¼ ì˜ ì½ì–´ë‚´ëŠ” ê°•ì ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.â€

**ì™œ ì´ë ‡ê²Œ ë‚˜ì˜¬ ìˆ˜ ìˆë‚˜?**  
â€¢ ìˆ˜ìš©ìì˜ ë§Â·í‘œì •Â·ëª¸ì§“ì—ì„œ ë‘ë ¤ì›€, ë¶ˆì•ˆ, ìˆ˜ì¹˜ì‹¬, ë¶„ë…¸ ê°™ì€ ê°ì •ì„ ë¹„êµì  ë¹¨ë¦¬ í¬ì°©í•˜ëŠ” ê²½í–¥ì´ ìˆìŠµë‹ˆë‹¤.  
â€¢ ì´ ë•ë¶„ì— â€˜ì´ ì‚¬ëŒì—ê²Œ ì§€ê¸ˆ ê°€ì¥ í•„ìš”í•œ ê²ƒì€ ë¬´ì—‡ì¸ê°€â€™ë¥¼ ê³ ë¯¼í•´ ë³¸ ê²½í—˜ì´ ë§ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**í˜„ì¥ ì˜ˆì‹œ**  
â€¢ ì‘ì€ í–‰ë™ ë³€í™”ë§Œ ë´ë„ â€œì˜¤ëŠ˜ì€ ë­”ê°€ ìƒíƒœê°€ ë‹¤ë¥´ë„¤, ë” ì˜ˆë¯¼í•´ì ¸ ìˆë„¤â€ë¼ê³  ëŠë¼ê³ , ì‹¤ì œë¡œë„ ì‚¬ê±´ì´ë‚˜ ìí•´ ì‹œë„ ë“±ì´ ì´ì–´ì¡Œë˜ ê²½í—˜ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
â€¢ ë°˜ëŒ€ë¡œ, ê·¸ë ‡ê²Œ ë§ì´ ëŠë¼ë‹¤ ë³´ë‹ˆ ì§‘ì— ê°€ì„œë„ ì¥ë©´ì´ ë– ì˜¤ë¥´ê³ , ë§ˆìŒì´ ì‰½ê²Œ ê°€ë¼ì•‰ì§€ ì•ŠëŠ” ê²½í—˜ì„ í–ˆì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

**ë‹¤ìŒ í•œ ê±¸ìŒ ì œì•ˆ**  
â€¢ ê°ì •ì— ë¯¼ê°í• ìˆ˜ë¡ ì •ì„œì  í”¼ë¡œë„ë„ í•¨ê»˜ ìŒ“ì…ë‹ˆë‹¤.  
â€¢ ë‚˜ ìì‹ ì„ ë³´í˜¸í•˜ê¸° ìœ„í•´  
  â€¢ ë™ë£Œì™€ ê²½í—˜ ë‚˜ëˆ„ê¸°  
  â€¢ íœ´ê°€Â·íœ´ì‹ ì ê·¹ ì‚¬ìš©í•˜ê¸°  
  â€¢ í•„ìš”ì‹œ ìƒë‹´Â·ìŠˆí¼ë¹„ì „ í™œìš©í•˜ê¸°  
ê°™ì€ â€˜ë‚´ ê°ì •ì„ ëŒë³´ëŠ” ì¥ì¹˜â€™ë¥¼ í•¨ê»˜ ê°–ì¶”ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.  
ì´ë ‡ê²Œ í•  ë•Œ, ê°(æ„Ÿ)ì˜ ê°•ì ì´ ì†Œì§„ìœ¼ë¡œ êº¼ì§€ì§€ ì•Šê³  ì˜¤ë˜ ìœ ì§€ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'''
}

# -------------------------
# í…ìŠ¤íŠ¸ ë³¸ë¬¸: ìˆ˜(å—) â€“ ê¸°ì¤€Â·ê·œë²” ì ìš©
# -------------------------

NORM_TEXT = {
    "low": '''**ìˆ˜(å—) â€“ ì €(ä½)**  

**í•œ ì¤„ ìš”ì•½**  
â€œìˆ˜(ê¸°ì¤€Â·ê·œë²” ì ìš©) ì ìˆ˜ê°€ ìƒëŒ€ì ìœ¼ë¡œ ë‚®ì€ í¸ì…ë‹ˆë‹¤.  
ì•Œê³  ìˆëŠ” ê¸°ì¤€ê³¼ ì‹¤ì œ ëŒ€ì‘ ì‚¬ì´ì˜ ê°„ê²©ì´ ì»¸ì„ ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤.â€

**ì™œ ì´ë ‡ê²Œ ë‚˜ì˜¬ ìˆ˜ ìˆë‚˜?**  
â€¢ í˜„ì¥ì˜ ì†ë„ê°€ ë§¤ìš° ë¹ ë¥´ê±°ë‚˜, ì¸ë ¥Â·í™˜ê²½ì˜ ì œì•½ì´ ì»¤ì„œ â€˜ì›ë˜ ì•Œê³  ìˆëŠ” ê¸°ì¤€â€™ê³¼ í˜„ì‹¤ ëŒ€ì‘ì´ ìì£¼ ì–´ê¸‹ë‚˜ëŠ” ê²½í—˜ì„ í–ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
â€¢ í—Œë²•Â·ê·œì •ì„ ëª°ë¼ì„œê°€ ì•„ë‹ˆë¼, **â€œê·¸ë ‡ê²Œ í•˜ê³  ì‹¶ì–´ë„ ì—¬ê±´ì´ ë°›ì³ì£¼ì§€ ì•Šì€ ìƒí™©â€** ì´ ë°˜ë³µë˜ì—ˆì„ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤.

**í˜„ì¥ ì˜ˆì‹œ**  
â€¢ â€œì‚¬ì‹¤ì€ ì´ ì •ë„ê¹Œì§€ë§Œ ì œì¬í•´ë„ ë  ê²ƒ ê°™ì€ë°â€¦â€ë¼ê³  ìƒê°í•˜ë©´ì„œë„, ë¶„ìœ„ê¸°ë‚˜ ê´€í–‰ ë•Œë¬¸ì— ë” ê°•í•œ ì¡°ì¹˜ë¥¼ ì„ íƒí–ˆë˜ ê¸°ì–µì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
â€¢ ì ˆì°¨ë¥¼ ì§€í‚¤ê³  ì‹¶ì—ˆì§€ë§Œ â€œì§€ê¸ˆì€ ê·¸ëƒ¥ ë¹¨ë¦¬ ì²˜ë¦¬í•˜ëŠ” ê²Œ ë§ë‹¤â€ê³  ëŠê»´ ìŠ¤ìŠ¤ë¡œ ë‚©ë“ì´ ì•ˆ ëœ ìˆœê°„ì´ ë‚¨ì•„ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ë‹¤ìŒ í•œ ê±¸ìŒ ì œì•ˆ**  
â€¢ ì´ ì ìˆ˜ëŒ€ì—ì„œëŠ” â€œì–´ë””ê°€ ì˜ëª»ëë‚˜â€ë¥¼ ì°¾ê¸°ë³´ë‹¤, â€œì–´ë–¤ ìƒí™©ì—ì„œ ê¸°ì¤€ì„ ë– ì˜¬ë¦¬ê¸° ê°€ì¥ ì–´ë ¤ì› ëŠ”ì§€â€ë¥¼ êµ¬ì²´ì ìœ¼ë¡œ í™•ì¸í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.  
â€¢ ê·¸ëŸ° ì¥ë©´ì„ í•˜ë‚˜ ë– ì˜¬ë ¤ â€œë‹¤ìŒì— ë¹„ìŠ·í•œ ìƒí™©ì´ ì˜¤ë©´, ì´ í•œ ê°€ì§€ë§Œì€ ê¼­ ì§€ì¼œë³´ìâ€ëŠ” ì‘ì€ ê¸°ì¤€ í•œ ì¤„ì„ ì •í•´ ë³´ëŠ” ê²ƒë¶€í„° ì‹œì‘í•´ë„ ì¢‹ìŠµë‹ˆë‹¤.''',

    "mid": '''**ìˆ˜(å—) â€“ ì¤‘(ä¸­)**  

**í•œ ì¤„ ìš”ì•½**  
â€œìˆ˜(ê¸°ì¤€Â·ê·œë²” ì ìš©) ì ìˆ˜ê°€ ì¤‘ê°„ ìˆ˜ì¤€ì…ë‹ˆë‹¤.  
ê¸°ì¤€ì„ ì˜ì‹ì€ í•˜ê³  ìˆìœ¼ë‚˜, í˜„ì‹¤ ì ìš© ê³¼ì •ì—ì„œ í”ë“¤ë¦´ ìˆ˜ ìˆëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤.â€

**ì™œ ì´ë ‡ê²Œ ë‚˜ì˜¬ ìˆ˜ ìˆë‚˜?**  
â€¢ ì •ë‹¹ì„±, í•„ìš”ì„±, ìµœì†Œì¹¨í•´, ì ˆì°¨ ì¤€ìˆ˜ ê°™ì€ ê¸°ì¤€ì„ ë¨¸ë¦¿ì†ìœ¼ë¡œëŠ” ìì£¼ ë– ì˜¬ë ¤ ì™”ìŠµë‹ˆë‹¤.  
â€¢ ë‹¤ë§Œ ì‹¤ì œ ìƒí™©ì—ì„œëŠ” ì†ë„Â·ì••ë ¥Â·ê´€í–‰ ë•Œë¬¸ì— ëê¹Œì§€ ì§€í‚¤ì§€ ëª»í•œ ê²½í—˜ë„ ìˆì—ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
â€¢ ê¸°ì¤€ì„ ë– ì˜¬ë¦¬ëŠ” ëŠ¥ë ¥ê³¼, ê·¸ê²ƒì„ í˜„ì‹¤ì— ë§ê²Œ ì ìš©í•˜ëŠ” ëŠ¥ë ¥ ì‚¬ì´ì— ë‹¤ë¦¬(bridge)ë¥¼ ë†“ëŠ” ê³¼ì •ì´ ì§„í–‰ ì¤‘ì¸ ë‹¨ê³„ë¼ê³  ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**í˜„ì¥ ì˜ˆì‹œ**  
â€¢ ë³´ê³ ì„œë‚˜ íšŒì˜ì—ì„œëŠ” â€œë¹„ë¡€ì„±, í•„ìš” ìµœì†Œí•œì˜ ì¡°ì¹˜â€ë¥¼ ì˜ ì„¤ëª…í•˜ì§€ë§Œ, í˜„ì¥ì—ì„œëŠ” **â€œì˜¤ëŠ˜ì€ ê·¸ëƒ¥ ì´ë ‡ê²Œ ë„˜ì–´ê°€ì•¼ê² ë‹¤â€** ê³  ëŠê¼ˆë˜ ìˆœê°„ë“¤ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
â€¢ ê°™ì€ ìƒí™©ì—ì„œë„ ì–´ë–¤ ë‚ ì€ ê¸°ì¤€ì„ ì˜ ì§€ì¼°ë‹¤ê³  ëŠë¼ê³ , ì–´ë–¤ ë‚ ì€ â€œì˜¤ëŠ˜ì€ ì¢€ ê³¼í–ˆë‚˜?â€ë¼ëŠ” ìƒê°ì´ ë‚¨ì•˜ì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

**ë‹¤ìŒ í•œ ê±¸ìŒ ì œì•ˆ**  
â€¢ êµìœ¡Â·ì‚¬ë¡€ í† ì˜ ë“±ì„ í†µí•´ ë¹„ìŠ·í•œ ìƒí™©ì—ì„œ ë‹¤ë¥¸ ëŒ€ì‘ì„ ì‹œë„í•´ ë³´ëŠ” ì—°ìŠµì„ í•´ ë³´ë©´ ê¸°ì¤€ ì ìš©ì˜ ì¼ê´€ì„±ì´ ë” ê°•í™”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
â€¢ íŠ¹íˆ â€œë‚´ê°€ ìì£¼ í—·ê°ˆë ¸ë˜ ìƒí™©â€ì„ í•˜ë‚˜ ì •í•´, ê·¸ ì¥ë©´ë§Œí¼ì€ ê¸°ì¤€ ì²´í¬ë¦¬ìŠ¤íŠ¸(ëª©ì â€“í•„ìš”ì„±â€“ìµœì†Œì¹¨í•´â€“ì ˆì°¨)ë¥¼ ê°„ë‹¨íˆ ë– ì˜¬ë ¤ ë³´ëŠ” ì—°ìŠµì´ ë„ì›€ì´ ë©ë‹ˆë‹¤.''',

    "high": '''**ìˆ˜(å—) â€“ ê³ (é«˜)**  

**í•œ ì¤„ ìš”ì•½**  
â€œìˆ˜(ê¸°ì¤€Â·ê·œë²” ì ìš©) ì ìˆ˜ê°€ ë†’ì€ í¸ì…ë‹ˆë‹¤.  
í—Œë²•Â·ê·œì •ì˜ ê¸°ì¤€ì„ ì‹¤ë¬´ íŒë‹¨ì— ìì—°ìŠ¤ëŸ½ê²Œ ëŒì–´ì˜¤ëŠ” ê°•ì ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.â€

**ì™œ ì´ë ‡ê²Œ ë‚˜ì˜¬ ìˆ˜ ìˆë‚˜?**  
â€¢ ì¡°ì¹˜ì˜ ëª©ì , í•„ìš”ì„±, ë¹„ë¡€ì„±, ì ˆì°¨ ì¤€ìˆ˜ë¥¼ íŒë‹¨ ê³¼ì •ì˜ ê¸°ë³¸ í‹€ë¡œ ì‚¼ì•„ ì˜¨ ê²½í—˜ì´ ë§ì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
â€¢ ë‹¨ìˆœí•œ â€˜ê·œì • ì¤€ìˆ˜â€™ë¥¼ ë„˜ì–´, í—Œë²•ì  ê¸°ì¤€ì„ ì‹¤ë¬´ íŒë‹¨ì˜ í•œ ì¶•ìœ¼ë¡œ ë‚´ë©´í™”í•œ ìƒíƒœì— ê°€ê¹ìŠµë‹ˆë‹¤.

**í˜„ì¥ ì˜ˆì‹œ**  
â€¢ ì¡°ì¹˜ë¥¼ í•˜ë©´ì„œ â€œì™œ ì´ ì¡°ì¹˜ê°€ í•„ìš”í•œì§€, ë‹¤ë¥¸ ì„ íƒì§€ëŠ” ì—†ëŠ”ì§€â€ë¥¼ ìì‹ ì´ë‚˜ ë™ë£Œì—ê²Œ ì„¤ëª…í•´ ë³¸ ê²½í—˜ì´ ìì£¼ ë– ì˜¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
â€¢ ë³´ê³ ì„œë‚˜ êµìœ¡ì—ì„œ ë¹„ë¡€ì„±Â·ìµœì†Œì¹¨í•´Â·ì ˆì°¨ì˜ ì˜ë¯¸ë¥¼ ì£¼ë³€ì—ê²Œ ì„¤ëª…í•´ ì¤€ ì ë„ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ë‹¤ìŒ í•œ ê±¸ìŒ ì œì•ˆ**  
â€¢ ê¸°ì¤€ì— ì¶©ì‹¤í•˜ë ¤ëŠ” ë§ˆìŒì´ ê°•í• ìˆ˜ë¡, í˜„ì¥ ì—¬ê±´ì´ ë”°ë¼ì£¼ì§€ ì•Šì„ ë•Œ ëŠë¼ëŠ” ìŠ¤íŠ¸ë ˆìŠ¤ë„ ì»¤ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
â€¢ â€œí•­ìƒ 100ì ì„ ëª» ëƒˆë‹¤â€ëŠ” ìì±…ë³´ë‹¤ëŠ”, â€œê°€ëŠ¥í•œ ë²”ìœ„ ì•ˆì—ì„œ ìµœì„ ì„ ë‹¤í–ˆë‹¤â€ëŠ” ê´€ì ì„ í•¨ê»˜ ê°€ì§€ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.  
â€¢ ê¸°ì¤€ì— ëŒ€í•œ ìì‹ ì˜ ê²½í—˜ì„ ë™ë£Œì™€ ë‚˜ëˆ„ëŠ” ê²ƒë§Œìœ¼ë¡œë„, ê¸°ê´€ ì „ì²´ì˜ ì¸ê¶Œ ê°ìˆ˜ì„± êµ¬ì¡°ë¥¼ ì§€ì§€í•˜ëŠ” ì—­í• ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'''
}

# -------------------------
# í…ìŠ¤íŠ¸ ë³¸ë¬¸: ì„±(æ€§) â€“ ì„±ì°°Â·ìê¸°ì ê²€
# -------------------------

REFLECT_TEXT = {
    "low": '''**ì„±(æ€§) â€“ ì €(ä½)**  

**í•œ ì¤„ ìš”ì•½**  
â€œì„±(ì„±ì°°) ì ìˆ˜ê°€ ìƒëŒ€ì ìœ¼ë¡œ ë‚®ì€ í¸ì…ë‹ˆë‹¤.  
ëŒì•„ë³´ê³  ì‹¶ì–´ë„ ê·¸ëƒ¥ í•˜ë£¨ë¥¼ ë„˜ê¸°ê²Œ ë˜ëŠ” ìƒí™©ì´ ë°˜ë³µë˜ì—ˆì„ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤.â€

**ì™œ ì´ë ‡ê²Œ ë‚˜ì˜¬ ìˆ˜ ìˆë‚˜?**  
â€¢ ì‚¬ê±´ì´ ë§ê³  íœ´ì‹ì´ ë¶€ì¡±í•œ í™˜ê²½ì—ì„œëŠ” **â€œì˜¤ëŠ˜ë„ ì–´ë–»ê²Œë“  ë²„í…¼ë‹¤â€** ë¼ëŠ” ëŠë‚Œë§Œ ë‚¨ê³ , ê·¸ë•Œê·¸ë•Œë¥¼ ë˜ëŒì•„ë³¼ ì—¬ìœ ê°€ ê±°ì˜ ì—†ì—ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
â€¢ ì´ëŠ” ì„±ì°°ì„ ëª¨ë¥´ê±°ë‚˜ ì¤‘ìš”í•˜ê²Œ ì—¬ê¸°ì§€ ì•Šì•„ì„œê°€ ì•„ë‹ˆë¼, ì •ì„œì Â·ì‹ ì²´ì  ì—ë„ˆì§€ê°€ ì´ë¯¸ ì†Œì§„ë˜ì–´ â€˜ëŒì•„ë³¼ í˜â€™ì´ ë¶€ì¡±í–ˆì„ ìˆ˜ ìˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

**í˜„ì¥ ì˜ˆì‹œ**  
â€¢ ê·¼ë¬´ë¥¼ ë§ˆì¹˜ê³  í‡´ê·¼í•˜ë©´ â€œê·¸ëƒ¥ ì•„ë¬´ ìƒê°ë„ í•˜ê¸° ì‹«ë‹¤â€ëŠ” ìƒíƒœë¡œ TVë‚˜ íœ´ëŒ€í°ì„ ë³´ë©° í•˜ë£¨ë¥¼ ëŠì–´ë‚´ëŠ” íŒ¨í„´ì´ ìµìˆ™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
â€¢ ê°€ë” ë– ì˜¤ë¥´ëŠ” ì¥ë©´ì´ ìˆë”ë¼ë„ â€œì§€ë‚˜ê°„ ì¼ì¸ë° ë­â€ë¼ë©° ë°”ë¡œ ë°€ì–´ë‚¸ ê²½í—˜ì´ ìˆì—ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ë‹¤ìŒ í•œ ê±¸ìŒ ì œì•ˆ**  
â€¢ ì´ ì ìˆ˜ëŒ€ì—ì„œì˜ ê³¼ì œëŠ” ê±°ì°½í•œ ìê¸°ë°˜ì„±ì´ ì•„ë‹ˆë¼, í•˜ë£¨ì— ë‹¨ í•œ ê°€ì§€ ì¥ë©´ë§Œì´ë¼ë„ â€œê·¸ë•Œ ë‚˜ëŠ” ì™œ ê·¸ë¬ì„ê¹Œ?â€í•˜ê³  ì§§ê²Œ ì§šì–´ë³´ëŠ” ì‘ì€ ì„±ì°°ì„ íšŒë³µí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.  
â€¢ ë©”ëª¨ë‚˜ ë§ˆìŒì†ìœ¼ë¡œ â€œë‹¤ìŒì—ëŠ” â—‹â—‹ë§Œì€ ê¼­ í•´ë³´ì / í•˜ì§€ ë§ìâ€ë¥¼ í•œ ì¤„ ë‚¨ê¸°ëŠ” ê²ƒë§Œìœ¼ë¡œë„ ì„±ì°°ì˜ íšŒë¡œê°€ ë‹¤ì‹œ ì—°ê²°ë˜ê¸° ì‹œì‘í•©ë‹ˆë‹¤.''',

    "mid": '''**ì„±(æ€§) â€“ ì¤‘(ä¸­)**  

**í•œ ì¤„ ìš”ì•½**  
â€œì„±(ì„±ì°°) ì ìˆ˜ê°€ ì¤‘ê°„ ìˆ˜ì¤€ì…ë‹ˆë‹¤.  
í° ì‚¬ê±´ ì´í›„ì—ëŠ” ëŒì•„ë³´ì§€ë§Œ, ì¼ìƒì ì¸ ì¥ë©´ì€ ê·¸ëƒ¥ ë„˜ê¸¸ ìˆ˜ ìˆëŠ” ìì—°ìŠ¤ëŸ¬ìš´ íŒ¨í„´ì…ë‹ˆë‹¤.â€

**ì™œ ì´ë ‡ê²Œ ë‚˜ì˜¬ ìˆ˜ ìˆë‚˜?**  
â€¢ ì¸ìƒ ê¹Šê±°ë‚˜ ë¶€ë‹´ì´ í° ì‚¬ê±´ ì´í›„ì—ëŠ” ìì‹ ì˜ ê°ì •ê³¼ ëŒ€ì‘ì„ ëª‡ ë²ˆì´ê³  ë– ì˜¬ë ¤ ë³¸ ê²½í—˜ì´ ìˆìŠµë‹ˆë‹¤.  
â€¢ ë‹¤ë§Œ, ë°˜ë³µë˜ëŠ” ì¼ê³¼ë‚˜ ì‘ì€ ê°ˆë“± ìƒí™©ì—ì„œëŠ” â€œê·¸ëƒ¥ ì´ëŸ° ê±°ì§€ ë­â€ë¼ë©° ê¹Šì´ ëŒì•„ë³´ì§€ ì•Šê³  ë„˜ì–´ê°„ ê²½ìš°ë„ ë§ì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**í˜„ì¥ ì˜ˆì‹œ**  
â€¢ í° ìí•´ ì‚¬ê±´, ì§‘ë‹¨ ê°ˆë“±, ë¯¼ê°í•œ ì§•ê³„ ì‚¬ê±´ ì´í›„ì—ëŠ” â€œê·¸ë•Œ ë‚´ê°€ ë„ˆë¬´ ê°•í–ˆë‚˜, ë§ì„ ë‹¤ ë“¤ì–´ì¤„ ê±¸ ê·¸ë¬ë‚˜â€ë¥¼ ë©°ì¹ ì”© ìƒê°í•´ ë³¸ ì ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
â€¢ ë°˜ë©´, ë§¤ì¼ ìˆëŠ” ì‚¬ì†Œí•œ ì–¸ìŸì´ë‚˜ ìš”êµ¬ ìƒí™©ì€ ê·¸ë‚ ê·¸ë‚  ìŠì–´ë²„ë¦¬ê³  ì§€ë‚˜ê°”ë˜ ê²½í—˜ì´ ë§ì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ë‹¤ìŒ í•œ ê±¸ìŒ ì œì•ˆ**  
â€¢ ì„±ì°°ì˜ í•„ìš”ì„±ì€ ì´ë¯¸ ì¶©ë¶„íˆ ì¸ì‹í•˜ê³  ìˆëŠ” ìƒíƒœì…ë‹ˆë‹¤.  
â€¢ ì˜ë„ì ìœ¼ë¡œ **ì •ê¸°ì ì¸ ì„±ì°° ì‹œê°„(ì˜ˆ: í•œ ì£¼ì— í•œ ë²ˆ 5ë¶„)** ë§Œ ë§Œë“¤ì–´ë„, ì´ë¯¸ ê°–ê³  ìˆëŠ” ì„±ì°° ì—­ëŸ‰ì´ í›¨ì”¬ ì•ˆì •ì ìœ¼ë¡œ ì‘ë™í•  ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤.  
â€¢ â€œì´ë²ˆ ì£¼ì— ê°€ì¥ ê¸°ì–µì— ë‚¨ëŠ” ì¥ë©´ í•œ ê°€ì§€ì™€, ë‹¤ìŒì— í•´ë³´ê³  ì‹¶ì€ ëŒ€ì‘ í•œ ê°€ì§€â€ë¥¼ ì§§ê²Œ ì •ë¦¬í•´ ë³´ëŠ” ì •ë„ë©´ ì¶©ë¶„í•©ë‹ˆë‹¤.''',

    "high": '''**ì„±(æ€§) â€“ ê³ (é«˜)**  

**í•œ ì¤„ ìš”ì•½**  
â€œì„±(ì„±ì°°) ì ìˆ˜ê°€ ë†’ì€ í¸ì…ë‹ˆë‹¤.  
ì‚¬ê±´ ì´í›„ ìì‹ ì˜ ê°ì •ê³¼ ëŒ€ì‘ì„ ëŒì•„ë³´ëŠ” ê³¼ì •ì´ ìŠµê´€í™”ë˜ì–´ ìˆëŠ” ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.â€

**ì™œ ì´ë ‡ê²Œ ë‚˜ì˜¬ ìˆ˜ ìˆë‚˜?**  
â€¢ ì‚¬ê±´ì´ ì§€ë‚˜ê°„ ë’¤ **â€œë‚´ê°€ ì™œ ê·¸ë•Œ ê·¸ë ‡ê²Œ ëŠê¼ˆëŠ”ì§€, ì™œ ê·¸ëŸ° ëŒ€ì‘ì„ í–ˆëŠ”ì§€â€** ë¥¼ ë°˜ë³µí•´ì„œ ë– ì˜¬ë ¤ ë³¸ ê²½í—˜ì´ ë§ìŠµë‹ˆë‹¤.  
â€¢ ì´ëŠ” ìì‹ ì˜ ë°˜ì‘ì„ ë¹„ë‚œí•˜ê¸° ìœ„í•¨ì´ ì•„ë‹ˆë¼, ë‹¤ìŒì— ë” ë‚˜ì€ ì„ íƒì„ í•˜ê¸° ìœ„í•œ í•™ìŠµ êµ¬ì¡°ë¡œ ì´í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**í˜„ì¥ ì˜ˆì‹œ**  
â€¢ ì¡°ì¹˜ê°€ ëë‚œ ë’¤ â€œë‹¤ìŒì— ë¹„ìŠ·í•œ ìƒí™©ì´ ì˜¤ë©´ ì´ë ‡ê²Œ ë§í•´ë³´ì, ì´ ì •ë„ ì„ ì—ì„œ ì¡°ì ˆí•´ ë³´ìâ€ëŠ” ìƒê°ì„ ì •ë¦¬í•´ ë‘” ì ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
â€¢ ë•Œë¡œëŠ” ê·¸ ê³¼ì •ì—ì„œ â€œê·¸ë•Œ ë” ì˜í–ˆì–´ì•¼ í–ˆë‹¤â€ëŠ” ìì±…ê³¼ ì£„ì±…ê°ì´ í•¨ê»˜ ì˜¬ë¼ì˜¨ ê²½í—˜ë„ ìˆì—ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ë‹¤ìŒ í•œ ê±¸ìŒ ì œì•ˆ**  
â€¢ ì„±ì°°ì´ ê¹Šì„ìˆ˜ë¡ ìì±…ë„ í•¨ê»˜ ì»¤ì§ˆ ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤.  
â€¢ â€œê·¸ë•Œì˜ ë‚˜ì—ê²Œë„ ë‚˜ë¦„ì˜ ì´ìœ ê°€ ìˆì—ˆë‹¤â€ëŠ” ê´€ì ì„ ìœ ì§€í•˜ë©°, ì„±ì°°ì„ ìê¸°ë¹„ë‚œì´ ì•„ë‹Œ ìê¸°ì´í•´ì™€ ë‹¤ìŒ ì„ íƒì„ ìœ„í•œ ì„¤ê³„ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.  
â€¢ ì„±ì°°ì„ í†µí•´ ë– ì˜¬ë¦° ê¹¨ë‹¬ìŒì„ êµ¬ì²´ì ì¸ í–‰ë™ ê¸°ì¤€ í•œ ì¤„ë¡œ ì •ë¦¬í•˜ë©´, ê°ì •ê³¼ ê¸°ì¤€, í–‰ë™ì´ ë” íƒ„íƒ„í•˜ê²Œ ì—°ê²°ë©ë‹ˆë‹¤.'''
}

# -------------------------
# ê°Â·ìˆ˜Â·ì„± ì¡°í•©/íŒ¨í„´ í…ìŠ¤íŠ¸
# -------------------------

PATTERN_TEXT = {
    "balance": '''**ê°Â·ìˆ˜Â·ì„± íŒ¨í„´ â€“ ê· í˜•í˜•**  

â€¢ ê°ì • ì¸ì‹, ê¸°ì¤€ ì ìš©, ì„±ì°° ê³¼ì •ì´ ì–´ëŠ í•œ ë¶€ë¶„ë§Œ íŠ€ì§€ ì•Šê³  ë¹„êµì  ê· í˜• ìˆê²Œ ì‘ë™í•˜ê³  ìˆìŠµë‹ˆë‹¤.  
â€¢ íŒë‹¨ êµ¬ì¡° ì „ì²´ê°€ í•œìª½ìœ¼ë¡œ ê³¼ë„í•˜ê²Œ ì¹˜ìš°ì¹˜ì§€ ì•Šì€ ìƒíƒœë¡œ, íŠ¹ì • ìƒí™©ì—ì„œ í”ë“¤ë¦¬ë”ë¼ë„ ë‹¤ì‹œ ì¤‘ì‹¬ì„ íšŒë³µí•  ìˆ˜ ìˆëŠ” ê¸°ë°˜ì´ ìˆìŒì„ ì‹œì‚¬í•©ë‹ˆë‹¤.  
â€¢ ì´ íŒ¨í„´ì—ì„œëŠ” ìƒˆë¡œìš´ ê²ƒì„ ë§ì´ ì¶”ê°€í•˜ê¸°ë³´ë‹¤, ì§€ê¸ˆì˜ êµ¬ì¡°ë¥¼ ì§€í‚¤ê³  ì†Œì§„ì„ ì˜ˆë°©í•˜ëŠ” ê²ƒì´ í•µì‹¬ ê³¼ì œì…ë‹ˆë‹¤.''',

    "emotion_dominant": '''**ê°Â·ìˆ˜Â·ì„± íŒ¨í„´ â€“ ê° ìš°ì„¸í˜•**  

â€¢ ì‚¬ëŒì˜ ê°ì •ê³¼ ë¶„ìœ„ê¸°ë¥¼ ë¯¼ê°í•˜ê²Œ ì½ì–´ë‚´ëŠ” ëŠ¥ë ¥ì´ ìƒëŒ€ì ìœ¼ë¡œ ë‘ë“œëŸ¬ì§„ íŒ¨í„´ì…ë‹ˆë‹¤.  
â€¢ ë‹¤ë§Œ ê·¸ë§Œí¼ ê¸°ì¤€(ê·œë²”)ê³¼ ì„±ì°°(ìê¸°ì ê²€)ì´ ë’¤ì—ì„œ ë”°ë¼ì˜¤ëŠ” ì†ë„ê°€ ì¡°ê¸ˆ ëŠë¦´ ìˆ˜ ìˆì–´, ê°ì •ì ìœ¼ë¡œëŠ” ì´í•´í•˜ë©´ì„œë„ ì‹¤ì œ ì¡°ì¹˜ì—ì„œëŠ” ì•„ì‰¬ì›€ì´ ë‚¨ëŠ” ê²½í—˜ì´ ìˆì—ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
â€¢ ì´ êµ¬ì¡°ì—ì„œëŠ” ì´ë¯¸ ê°•ì ì¸ ê°ì • ì¸ì‹ì„ ë°”íƒ•ìœ¼ë¡œ, ê°ì • â†’ ê¸°ì¤€ â†’ ì„±ì°°ë¡œ ì´ì–´ì§€ëŠ” ê°„ë‹¨í•œ ì²´í¬ë¦¬ìŠ¤íŠ¸ë‚˜ í•œ ë¬¸ì¥ ê¸°ì¤€ì„ ë¯¸ë¦¬ ë§Œë“¤ì–´ ë‘ë©´ íŒë‹¨ êµ¬ì¡° ì „ì²´ê°€ ë” ì•ˆì •ì ìœ¼ë¡œ ì‘ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.''',

    "norm_dominant": '''**ê°Â·ìˆ˜Â·ì„± íŒ¨í„´ â€“ ìˆ˜ ìš°ì„¸í˜•**  

â€¢ ê·œì •, ì ˆì°¨, ë¹„ë¡€ì„± ê¸°ì¤€ì„ ì¤‘ìš”í•˜ê²Œ ì—¬ê¸°ëŠ” íƒœë„ê°€ ëšœë ·í•˜ê²Œ ë‚˜íƒ€ë‚˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤.  
â€¢ ê°ì •ê³¼ ì„±ì°° ì ìˆ˜ê°€ ìƒëŒ€ì ìœ¼ë¡œ ë‚®ê±°ë‚˜ ì¤‘ê°„ì¸ ê²½ìš°, **â€œê¸°ì¤€ì€ ì•Œê³  ìˆì§€ë§Œ ê°ì •ì´ë‚˜ í”¼ë¡œë¥¼ ëŒì•„ë³¼ ì—¬ìœ ê°€ ë¶€ì¡±í–ˆë˜ ìƒí™©â€** ì´ ë§ì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
â€¢ ì´ íŒ¨í„´ì—ì„œëŠ” ê¸°ì¤€ì˜ ê°•ì ì„ ìœ ì§€í•˜ë˜, **â€œê·¸ë•Œ ë‚˜ëŠ” ì–´ë–¤ ê°ì •ì´ì—ˆëŠ”ê°€?â€ â€œì§€ê¸ˆ ë‚˜ì—ê²Œ ì–´ë–¤ ë¶€ë‹´ì´ ìŒ“ì˜€ëŠ”ê°€?â€** ë¥¼ í•œ ë²ˆ ë” ì§šì–´ë³´ëŠ” ì—°ìŠµì´ ì´ë£¨ì–´ì§„ë‹¤ë©´, ê·œë²”ê³¼ ì‚¬ëŒì„ ë™ì‹œì— ê³ ë ¤í•˜ëŠ” ì¸ê¶Œê°ìˆ˜ì„± êµ¬ì¡°ë¡œ í™•ì¥ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.''',

    "reflect_dominant": '''**ê°Â·ìˆ˜Â·ì„± íŒ¨í„´ â€“ ì„± ìš°ì„¸í˜•**  

â€¢ ì‚¬ê±´ì´ ì§€ë‚˜ê°„ ë’¤ ìì‹ ì˜ ëŒ€ì‘ê³¼ ê°ì •ì„ ë˜ì§šì–´ë³´ëŠ” í˜ì´ ê°•í•˜ê²Œ ë‚˜íƒ€ë‚˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤.  
â€¢ ë‹¤ë§Œ ê·¸ ê³¼ì •ì—ì„œ â€œê·¸ë•Œ ë” ì˜í–ˆì–´ì•¼ í–ˆë‹¤â€ëŠ” ìì±…ì´ ì»¤ì§€ê±°ë‚˜, ê¸°ì¤€ ì ìš©ì— ëŒ€í•œ ì•„ì‰¬ì›€ì´ ìì£¼ ë– ì˜¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
â€¢ ì´ êµ¬ì¡°ì—ì„œëŠ” ì´ë¯¸ ê°•í•œ ì„±ì°°ì„ ìê¸°ë¹„ë‚œì´ ì•„ë‹Œ â€˜ë‹¤ìŒ ì„ íƒì„ ìœ„í•œ ì„¤ê³„â€™ë¡œ ì „í™˜í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.  
  â€¢ ì˜ˆ: â€œë‹¤ìŒì— ë¹„ìŠ·í•œ ìƒí™©ì´ ì˜¤ë©´ â—‹â—‹ë§Œì€ ê¼­ ì§€ì¼œë³´ìâ€  
ì´ë ‡ê²Œ êµ¬ì²´ì  í–‰ë™ ê¸°ì¤€ìœ¼ë¡œ ì—°ê²°í•˜ë©´, ì„±ì°°ì´ ë‚˜ë¥¼ ëˆ„ë¥´ëŠ” í˜ì´ ì•„ë‹ˆë¼ ë‚˜ë¥¼ ì§€ì§€í•˜ëŠ” í˜ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.''',

    "transition_dynamic": '''**ì „ì´í˜•(Transition Type)**
    
â€¢ ê°ì • â†’ ê¸°ì¤€ â†’ ì„±ì°° íë¦„ì—ì„œ íŠ¹ì • ì‹œì ì— ì—°ê²°ì´ ëŠìŠ¨í•´ì§€ê±°ë‚˜ ì „ì´ë˜ëŠ” ê²½í–¥ì´ ê´€ì°°ë©ë‹ˆë‹¤.
â€¢ ì´ëŠ” ì—­ëŸ‰ ë¶€ì¡±ì´ ì•„ë‹ˆë¼, ì‚¬ê±´ì˜ ì†ë„Â·í™˜ê²½Â·ìì› ì œì•½ ë“± ì™¸ë¶€ ì¡°ê±´ì— ì˜í•´ íšŒë¡œ ì‘ë™ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
â€¢ â€œí•œ ì¥ë©´ì”© ëŒì•„ë³´ëŠ” ì§§ì€ ì ê²€ ë°©ì‹â€ì´ ë¶€ë‹´ ì—†ì´ ì‹¤ì²œ ê°€ëŠ¥í•œ ê°œì„  ê²½ë¡œì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.''',

    "reflective_dynamic": '''**ì—­ë™ì  ë³€í™”í˜•(Dynamic Shift Type)**
    
â€¢ ì´ˆê¸°ì—ëŠ” ê°ì • ìê°ì´ ë‚®ì•„ ë³´ì—¬ë„, ì‚¬ê±´ ì´í›„ ê¸°ì¤€Â·ì„±ì°° ê³¼ì •ì—ì„œ ë°˜ì‘ì´ ì¡°ì •ë˜ëŠ” ì—­ë™ì  êµ¬ì¡°ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.
â€¢ ì´ ìœ í˜•ì€ ê°ì •â†’ê¸°ì¤€â†’ì„±ì°°ì´ â€œì‹œê°„ì°¨ë¡œ ì‘ë™í•˜ëŠ” êµ¬ì¡°â€ë¡œ ë³¼ ìˆ˜ ìˆìœ¼ë©°, ê°œì„  ê°€ëŠ¥í•œ ì ì¬ì  ê°•ì ìœ¼ë¡œ í•´ì„ë©ë‹ˆë‹¤.
â€¢ ì„±ì°°ì„ â€˜í‰ê°€/ë°˜ì„±â€™ì´ ì•„ë‹ˆë¼ â€œë‹¤ìŒ ì„ íƒ ì„¤ê³„ ê³¼ì •â€ìœ¼ë¡œ ì‚¬ìš©í•  ë•Œ êµ¬ì¡°ì  ì•ˆì •ì„±ì´ ë†’ì•„ì§‘ë‹ˆë‹¤.''',

    "one_axis_extreme": '''**ê°Â·ìˆ˜Â·ì„± íŒ¨í„´ â€“ í•œ ì¶•ì´ ë‘ë“œëŸ¬ì§„ ìœ í˜•**  

â€¢ ì„¸ ì¶• ì¤‘ í•˜ë‚˜ê°€ ìœ ë… ë‚®ê±°ë‚˜ ë†’ì€ ê²½ìš°, ê·¸ ì¶•ì€ ê°•ì ì´ì ë™ì‹œì— ì·¨ì•½ì ì´ ë  ìˆ˜ ìˆëŠ” ì§€ì ì…ë‹ˆë‹¤.  
â€¢ ì˜ˆë¥¼ ë“¤ì–´ ì„±ì°°ë§Œ ìœ ë… ë‚®ë‹¤ë©´, â€œëŒì•„ë³¼ ì—¬ìœ ê°€ ì—†ë‹¤â€ëŠ” í™˜ê²½ì  ë©”ì‹œì§€ì¼ ìˆ˜ ìˆê³ , ê°ì •ë§Œ ìœ ë… ë†’ë‹¤ë©´ ì •ì„œì  í”¼ë¡œê°€ ë” ë¹¨ë¦¬ ëˆ„ì ë  ìˆ˜ ìˆëŠ” ì‹ í˜¸ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
â€¢ ì´ íŒ¨í„´ì€ â€œì–´ë””ê°€ ë¬¸ì œëƒâ€ë¥¼ ì°¾ê¸°ë³´ë‹¤, â€œì–´ë””ë¥¼ ì¡°ê¸ˆë§Œ ë³´ì™„í•˜ë©´ ì „ì²´ êµ¬ì¡°ê°€ ë” ì•ˆì •ë ì§€â€ë¥¼ ê²°ì •í•˜ëŠ” ë‚˜ì¹¨ë°˜ìœ¼ë¡œ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'''
}

def detect_pattern(gam_level: str, su_level: str, seong_level: str) -> str:
    """
    ê°/ìˆ˜/ì„± ìˆ˜ì¤€ ì¡°í•©ìœ¼ë¡œ íŒ¨í„´ íŒë‹¨
    - low=0, mid=1, high=2 ë¡œ ë‘ê³  ìƒëŒ€ ë¹„êµ
    """
    lv = {"low": 0, "mid": 1, "high": 2}
    g, s, e = lv[gam_level], lv[su_level], lv[seong_level]

    # ê· í˜•í˜•: ì„¸ ì¶•ì´ ê±°ì˜ ê°™ì€ ìˆ˜ì¤€
    if abs(g - s) <= 0 and abs(g - e) <= 0:
        return "balance"

    # ê° ìš°ì„¸
    if g >= s + 1 and g >= e + 1:
        return "emotion_dominant"

    # ìˆ˜ ìš°ì„¸
    if s >= g + 1 and s >= e + 1:
        return "norm_dominant"

    # ì„± ìš°ì„¸
    if e >= g + 1 and e >= s + 1:
        return "reflect_dominant"

    # ì „ì´í˜•: ê° â‰¥ ìˆ˜ â‰¥ ì„±
    if g >= s >= e and (g > e):
        return "transition_dynamic"

    # ì—­ë™í˜•: ê° â‰¤ ìˆ˜ â‰¤ ì„±
    if g <= s <= e and (g < e):
        return "reflective_dynamic"

    # ê·¸ ì™¸ëŠ” í•œ ì¶•ë§Œ í˜„ì €íˆ ë‹¤ë¥¸ ê²½ìš°ë¡œ ì²˜ë¦¬
    return "one_axis_extreme"

# -------------------------
# ì •ì‹ ì§ˆí™˜ ìˆ˜ìš©ì ê´€ë ¨ ê°ìˆ˜ì„± í…ìŠ¤íŠ¸
# -------------------------

MENTAL_TEXT = {
    "low": '''**ì •ì‹ ì§ˆí™˜ ìˆ˜ìš©ì ê°ìˆ˜ì„± â€“ ì €(ä½)**  

**í•œ ì¤„ ìš”ì•½**  
â€œì •ì‹ ì§ˆí™˜ ìˆ˜ìš©ì ê´€ë ¨ ê°ìˆ˜ì„± ì§€ìˆ˜ê°€ ìƒëŒ€ì ìœ¼ë¡œ ë‚®ì€ í¸ì…ë‹ˆë‹¤.  
ì´ ì˜ì—­ì„ ë‹´ë‹¹í•  ë•Œ ë¶€ë‹´ê³¼ ì–´ë ¤ì›€ì´ ë§¤ìš° ì»¸ë‹¤ëŠ” ì‹ í˜¸ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.â€

**ì™œ ì´ë ‡ê²Œ ë‚˜ì˜¬ ìˆ˜ ìˆë‚˜?**  
â€¢ ì •ì‹ ì§ˆí™˜ì„ ê°€ì§„ ìˆ˜ìš©ìë¥¼ ëŒ€í•  ë•Œ ì •ì„œì Â·ì¸ì§€ì  ë¶€ë‹´ì´ ë§¤ìš° ì»¸ê±°ë‚˜, ë¬´ì—‡ì´ ìµœì„ ì¸ì§€ í™•ì‹ í•˜ê¸° ì–´ë ¤ìš´ ìƒí™©ì´ ë°˜ë³µë˜ì—ˆì„ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤.  
â€¢ ì´ëŠ” ì¸ê¶Œ ê°ìˆ˜ì„±ì´ ë¶€ì¡±í•´ì„œë¼ê¸°ë³´ë‹¤, ì „ë¬¸ì§€ì›Â·ì¸ë ¥Â·ì‹œê°„ì´ ì¶©ë¶„í•˜ì§€ ì•Šì€ êµ¬ì¡° ì†ì—ì„œ ëŒ€ì‘í•´ ì˜¨ í˜„ì‹¤ì„ ë°˜ì˜í•˜ëŠ” ê²°ê³¼ë¡œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**í˜„ì¥ ì˜ˆì‹œ**  
â€¢ ì˜ˆì¸¡í•˜ê¸° ì–´ë ¤ìš´ í–‰ë™, ë°˜ë³µë˜ëŠ” í˜¸ì†Œ, ìí•´ ìœ„í—˜ ë“±ì„ í˜¼ìì„œ ê°ë‹¹í•´ì•¼ í•œë‹¤ê³  ëŠê¼ˆë˜ ìˆœê°„ì´ ë§ì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
â€¢ â€œì´ê²Œ ë§ëŠ” ëŒ€ì‘ì¸ì§€ ëª¨ë¥´ê² ì§€ë§Œ, ì§€ê¸ˆì€ ì´ë ‡ê²Œ í•  ìˆ˜ë°–ì— ì—†ë‹¤â€ëŠ” ë§‰ë§‰í•¨ê³¼ ë¶ˆì•ˆê°ì„ ìì£¼ ëŠê¼ˆì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

**ë‹¤ìŒ í•œ ê±¸ìŒ ì œì•ˆ**  
â€¢ ì´ ì ìˆ˜ëŒ€ëŠ” ê°œì¸ì„ í‰ê°€í•˜ê¸° ìœ„í•œ ê²ƒì´ ì•„ë‹ˆë¼, â€œì •ì‹ ì§ˆí™˜ ìˆ˜ìš©ì ëŒ€ì‘ì—ëŠ” ì¶”ê°€ì ì¸ ì§€ì›ê³¼ ìì›ì´ í•„ìš”í•˜ë‹¤â€ëŠ” êµ¬ì¡°ì  ë©”ì‹œì§€ë¡œ ì´í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
â€¢ ê°€ëŠ¥í•œ ë²”ìœ„ì—ì„œ  
  â€¢ ë™ë£Œì™€ì˜ ì •ë³´ ê³µìœ   
  â€¢ ì •ì‹ ì˜í•™Â·ì‹¬ë¦¬ì „ë¬¸ê°€ì™€ì˜ ì—°ê³„  
  â€¢ ê´€ë ¨ êµìœ¡ ì°¸ì—¬  
ë“±ì„ í†µí•´, â€œí˜¼ì ë²„í‹°ëŠ” ìë¦¬â€ë¥¼ â€œí•¨ê»˜ ë‚˜ëˆ„ëŠ” ìë¦¬â€ë¡œ ë°”ê¾¸ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.''',

    "mid": '''**ì •ì‹ ì§ˆí™˜ ìˆ˜ìš©ì ê°ìˆ˜ì„± â€“ ì¤‘(ä¸­)**  

**í•œ ì¤„ ìš”ì•½**  
â€œì •ì‹ ì§ˆí™˜ ìˆ˜ìš©ì ê´€ë ¨ ê°ìˆ˜ì„± ì§€ìˆ˜ê°€ ì¤‘ê°„ ìˆ˜ì¤€ì…ë‹ˆë‹¤.  
ì–´ë–¤ ì¥ë©´ì—ì„œëŠ” ì˜ ëŒ€ì‘í–ˆì§€ë§Œ, ì–´ë–¤ ì¥ë©´ì—ì„œëŠ” ìì‹ ê°ì´ ë–¨ì–´ì¡Œì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.â€

**ì™œ ì´ë ‡ê²Œ ë‚˜ì˜¬ ìˆ˜ ìˆë‚˜?**  
â€¢ ì¼ë¶€ ìƒí™©ì—ì„œëŠ” ê°ì •Â·ê¸°ì¤€Â·ì„±ì°°ì´ ì˜ ì‘ë™í–ˆì§€ë§Œ, ìœ„í—˜ë„ê°€ ë†’ê±°ë‚˜ ì˜ˆì¸¡ì´ ì–´ë ¤ìš´ ì¥ë©´ì—ì„œëŠ” ìì‹ ê°ì´ ë–¨ì–´ì§€ê±°ë‚˜ ë¶€ë‹´ì´ í¬ê²Œ ëŠê»´ì¡Œì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
â€¢ ì´ëŠ” ë§ì€ êµì • ì‹¤ë¬´ìê°€ ê³µí†µì ìœ¼ë¡œ ê²½í—˜í•˜ëŠ” ì˜ì—­ì´ë©°, ê°œì¸ ì—­ëŸ‰ë³´ë‹¤ ê¸°ê´€ ì°¨ì›ì˜ êµìœ¡Â·ë§¤ë‰´ì–¼Â·ì „ë¬¸ê°€ ì—°ê³„ ì—¬ë¶€ì— í¬ê²Œ ì˜í–¥ì„ ë°›ëŠ” ì§€ì ì…ë‹ˆë‹¤.

**í˜„ì¥ ì˜ˆì‹œ**  
â€¢ ìƒíƒœê°€ ë¹„êµì  ì•ˆì •ëœ ìˆ˜ìš©ìì™€ì˜ ìƒë‹´Â·ì§€ë„ì—ì„œëŠ” â€œëŒ€í™”ê°€ ì˜ í†µí•œë‹¤â€ëŠ” ëŠë‚Œì„ ë°›ì€ ì ì´ ìˆìŠµë‹ˆë‹¤.  
â€¢ ë°˜ëŒ€ë¡œ ê¸‰ì„± ì•…í™”ë‚˜ ë°˜ë³µëœ ìí•´ ì‹œë„ì²˜ëŸ¼ ìœ„í—˜ë„ê°€ ë†’ì€ ìƒí™©ì—ì„œëŠ” â€œì´ ì´ìƒ ì–´ë–»ê²Œ í•´ì•¼ í• ì§€ ëª¨ë¥´ê² ë‹¤â€ëŠ” í•œê³„ë¥¼ ëŠê¼ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ë‹¤ìŒ í•œ ê±¸ìŒ ì œì•ˆ**  
â€¢ ì´ ì ìˆ˜ëŒ€ì—ì„œëŠ” â€œë‚´ê°€ ë¶€ì¡±í•˜ë‹¤â€ê¸°ë³´ë‹¤, â€œì´ ì˜ì—­ì„ í•¨ê»˜ ê³ ë¯¼í•˜ê³  í›ˆë ¨í•  í•„ìš”ê°€ ìˆë‹¤â€ëŠ” ì‹ í˜¸ë¡œ í•´ì„í•˜ëŠ” ê²ƒì´ ì ì ˆí•©ë‹ˆë‹¤.  
â€¢ ì‹¤ì œ ê²½í—˜ì„ ê¸°ë°˜ìœ¼ë¡œ  
  â€¢ ê°€ì¥ ì–´ë ¤ì› ë˜ ì¥ë©´ í•œ ê°€ì§€  
  â€¢ ê·¸ë•Œ í•„ìš”í•œ ì§€ì›ì´ë‚˜ ì •ë³´ê°€ ë¬´ì—‡ì´ì—ˆëŠ”ì§€  
ë¥¼ ì •ë¦¬í•´ ë‘ë©´, í–¥í›„ êµìœ¡Â·ì§€ì›ì²´ê³„ë¥¼ ë…¼ì˜í•  ë•Œ ì¤‘ìš”í•œ ê·¼ê±°ê°€ ë©ë‹ˆë‹¤.''',

    "high": '''**ì •ì‹ ì§ˆí™˜ ìˆ˜ìš©ì ê°ìˆ˜ì„± â€“ ê³ (é«˜)**  

**í•œ ì¤„ ìš”ì•½**  
â€œì •ì‹ ì§ˆí™˜ ìˆ˜ìš©ì ê´€ë ¨ ê°ìˆ˜ì„± ì§€ìˆ˜ê°€ ë¹„êµì  ë†’ì€ í¸ì…ë‹ˆë‹¤.  
ì´ ì˜ì—­ì—ì„œë„ ê°ì •Â·ê¸°ì¤€Â·ì„±ì°°ì„ ìœ ì§€í•˜ë ¤ëŠ” ë…¸ë ¥ì´ ì•ˆì •ì ìœ¼ë¡œ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.â€

**ì™œ ì´ë ‡ê²Œ ë‚˜ì˜¬ ìˆ˜ ìˆë‚˜?**  
â€¢ ì •ì‹ ì§ˆí™˜ì„ ê°€ì§„ ìˆ˜ìš©ìë¥¼ ëŒ€í•  ë•Œì—ë„ ê°ì • ì‹ í˜¸ë¥¼ ì½ìœ¼ë ¤ëŠ” ì‹œë„, ê¸°ì¤€ì— ë§ì¶”ë ¤ëŠ” ë…¸ë ¥, ìƒí™©ì„ ëŒì•„ë³´ëŠ” ì„±ì°°ì´ ë¹„êµì  ê¾¸ì¤€íˆ ìœ ì§€ë˜ì–´ ì™”ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
â€¢ ì´ëŠ” ì „ë¬¸ì§€ì‹ì˜ ë§ê³  ì ìŒì„ ë– ë‚˜, â€œìœ„í—˜ì„ ì¤„ì´ë©´ì„œë„ ì‚¬ëŒìœ¼ë¡œ ëŒ€í•˜ë ¤ëŠ” íƒœë„â€ê°€ êµ¬ì¡°í™”ë˜ì–´ ìˆìŒì„ ë³´ì—¬ì£¼ëŠ” ê°•ì ì…ë‹ˆë‹¤.

**í˜„ì¥ ì˜ˆì‹œ**  
â€¢ ìƒíƒœê°€ ë¶ˆì•ˆì •í•œ ìˆ˜ìš©ìë¥¼ ë§Œë‚  ë•Œ â€œì´ ì‚¬ëŒì´ ì§€ê¸ˆ ì–´ë–¤ ë‘ë ¤ì›€ê³¼ í˜¼ë€ ì†ì— ìˆëŠ”ì§€â€ë¥¼ ë– ì˜¬ë ¤ ë³´ë©° ë§íˆ¬Â·ê±°ë¦¬Â·ì¡°ì¹˜ë¥¼ ì¡°ì ˆí•´ ë³¸ ê²½í—˜ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
â€¢ ì–´ë ¤ìš´ ì¥ë©´ ì´í›„ì—ë„ â€œë‹¤ìŒì—ëŠ” ì–´ë–¤ ì‹ìœ¼ë¡œ ë„ì™€ë³¼ ìˆ˜ ìˆì„ê¹Œ?â€ë¥¼ í˜¼ì ë˜ëŠ” ë™ë£Œì™€ í•¨ê»˜ ë…¼ì˜í•´ë³¸ ì ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ë‹¤ìŒ í•œ ê±¸ìŒ ì œì•ˆ**  
â€¢ ì´ ì˜ì—­ì€ ì •ì„œì  ì†Œëª¨ê°€ íŠ¹íˆ í° ë¶„ì•¼ì…ë‹ˆë‹¤.  
â€¢ ë³¸ì¸ì˜ í”¼ë¡œì™€ ë¶€ë‹´ì„ ì œë•Œ ë‚˜ëˆ„ì§€ ëª»í•˜ë©´, ë²ˆì•„ì›ƒê³¼ ë¬´ë ¥ê°ìœ¼ë¡œ ì´ì–´ì§ˆ ìœ„í—˜ë„ ìˆìŠµë‹ˆë‹¤.  
â€¢ ë™ë£Œ ì§€ì›, ìŠˆí¼ë¹„ì „, ìƒë‹´ ë“± ìì‹ ì˜ ê°ì •ì„ ëŒë³´ëŠ” í†µë¡œë¥¼ ê¾¸ì¤€íˆ í™•ë³´í•˜ëŠ” ê²ƒì´ ì§€ê¸ˆì˜ ê°•ì ì„ ì˜¤ë˜ ìœ ì§€í•˜ëŠ” í•µì‹¬ì…ë‹ˆë‹¤.'''
}

# -------------------------
# ê³µí†µ ì¢…í•© ë©”ì‹œì§€
# -------------------------

SUMMARY_MESSAGE = '''**ê³µí†µ ì¢…í•© ë©”ì‹œì§€**  

â€œê°Â·ìˆ˜Â·ì„± ì¸ê¶Œê°ìˆ˜ì„±ì€ ì„±ê²©ì´ ì•„ë‹ˆë¼ â€˜ì¡°ê±´ê³¼ êµ¬ì¡°â€™ì˜ ë¬¸ì œì…ë‹ˆë‹¤.

ì´ë²ˆ ê²°ê³¼ëŠ” ë‚˜ì˜ ì¸ê¶Œê°ìˆ˜ì„± ìˆ˜ì¤€ì„ í‰ê°€Â·íŒì •í•˜ê¸° ìœ„í•œ ê²ƒì´ ì•„ë‹ˆë¼,  
**ì–´ë–¤ ì¡°ê±´ì—ì„œ ê°ì •â€“ê¸°ì¤€â€“ì„±ì°°ì´ ì˜ ì—°ê²°ë˜ê³ , ì–´ë–¤ ì¡°ê±´ì—ì„œ ëŠì–´ì§€ëŠ”ì§€ë¥¼ ì‚´í´ë³´ëŠ” ì§€ë„(map)** ì— ê°€ê¹ìŠµë‹ˆë‹¤.  

íŠ¹íˆ ì •ì‹ ì§ˆí™˜ ìˆ˜ìš©ìë¥¼ ëŒ€í•˜ëŠ” ì¥ë©´ì€ ì¼ë°˜ ìƒí™©ë³´ë‹¤ í›¨ì”¬ ë§ì€ ìì›ì´ í•„ìš”í•˜ë©°,  
ì´ ì˜ì—­ì—ì„œì˜ ì–´ë ¤ì›€ì€ ë¶€ì¡±í•¨ì´ ì•„ë‹ˆë¼ ì¶”ê°€ ì§€ì›ì´ í•„ìš”í•œ ì‹ í˜¸ë¡œ ì´í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  

ì§€ê¸ˆ ì´ ê²°ê³¼ë¥¼ â€˜ë‚˜ì˜ í•œê³„â€™ê°€ ì•„ë‹ˆë¼,  
ì•ìœ¼ë¡œ ë‚˜ì™€ ë™ë£Œ, ê¸°ê´€ì´ í•¨ê»˜ ì¡°ì •í•´ ê°ˆ ìˆ˜ ìˆëŠ” íŒë‹¨ êµ¬ì¡°ì˜ ì¶œë°œì ìœ¼ë¡œ í™œìš©í•´ ì£¼ì‹œë©´ ì¢‹ê² ìŠµë‹ˆë‹¤.'''

# ----------------------------------------------------
# ğŸ§½ PDFìš© í•œì ì œê±° í•¨ìˆ˜ (PDF ì¶œë ¥ ì „ í…ìŠ¤íŠ¸ ì •ë¦¬)
# ----------------------------------------------------
def strip_hanja_for_pdf(text: str) -> str:
    """
    PDFì—ì„œëŠ” í•œìë¥¼ ì œê±°í•˜ê³  í•œê¸€/ìˆ«ìë§Œ ì¶œë ¥ë˜ë„ë¡ ì •ë¦¬
    """
    replacements = {
        "ê°(æ„Ÿ)": "ê°",
        "ìˆ˜(å—)": "ìˆ˜",
        "ì„±(æ€§)": "ì„±",
        "ì €(ä½)": "ì €",
        "ì¤‘(ä¸­)": "ì¤‘",
        "ê³ (é«˜)": "ê³ ",
    }
    for k, v in replacements.items():
        text = text.replace(k, v)
    return text

def make_radar_image(gam, su, seong, mh_gam, mh_su, mh_seong):
    labels = np.array(["ê°", "ìˆ˜", "ì„±"])
    angles = np.linspace(0, 2 * np.pi, len(labels), endpoint=False)
    
    values_total = np.array([gam, su, seong])
    values_mh = np.array([mh_gam, mh_su, mh_seong])

    # ë‹«íŒ ë„í˜•ì„ ìœ„í•´ ë‹¤ì‹œ ì²« ê°’ ë¶™ì´ê¸°
    values_total = np.concatenate((values_total, [values_total[0]]))
    values_mh = np.concatenate((values_mh, [values_mh[0]]))
    angles_closed = np.concatenate((angles, [angles[0]]))

    fig = plt.figure(figsize=(3, 3))
    ax = fig.add_subplot(111, polar=True)

    # ì „ì²´ ì ìˆ˜
    ax.plot(angles_closed, values_total)
    ax.fill(angles_closed, values_total, alpha=0.2)

    # ì •ì‹ ì§ˆí™˜ ìƒí™© ì ìˆ˜
    ax.plot(angles_closed, values_mh)
    ax.fill(angles_closed, values_mh, alpha=0.2)

    ax.set_thetagrids(angles * 180/np.pi, labels)
    ax.set_ylim(0, 36)

    buf = BytesIO()
    fig.savefig(buf, format="png", dpi=150, bbox_inches="tight")
    plt.close(fig)
    buf.seek(0)
    return buf

# =========================
#  PDF ê²°ê³¼ì§€ ìƒì„± í•¨ìˆ˜ (ì—¬ë°±/ì¤„ë°”ê¿ˆ ë³´ì • ë²„ì „)
# =========================

def make_result_pdf(result: dict, demographic: dict | None = None) -> bytes:
    """
    í•œ í˜ì´ì§€ìš© ê°„ë‹¨ ê²°ê³¼ PDF ìƒì„±:
    - ì œëª©
    - ì‘ë‹µì¼ì‹œ
    - ì´ì  + ê°/ìˆ˜/ì„± + ì •ì‹ ì§ˆí™˜ ì ìˆ˜ í•œ ì¤„ ìš”ì•½
    - ë ˆì´ë” ì°¨íŠ¸(ì „ì²´ vs ì •ì‹ ì§ˆí™˜ ìƒí™©)
    - OVERALL_TEXT (ì „ì²´ ì¸ê¶Œê°ìˆ˜ì„± í•´ì„)
    - MENTAL_TEXT (ì •ì‹ ì§ˆí™˜ ìˆ˜ìš©ì ê°ìˆ˜ì„± í•´ì„)
    - SUMMARY_MESSAGE (ê³µí†µ ì¢…í•© ë©”ì‹œì§€)
    - í•˜ë‹¨ ë¹„ì§„ë‹¨Â·ë¹„í‰ê°€ ê³ ì§€ë¬¸
    """

    buffer = BytesIO()
    c = canvas.Canvas(buffer, pagesize=A4)
    width, height = A4

    # ì—¬ë°± ì„¤ì • (ì¢Œìš° ë™ì¼)
    margin_x = 25 * mm
    margin_y = 20 * mm
    y = height - margin_y

    # ---------- 0. ì ìˆ˜Â·í…ìŠ¤íŠ¸ ì¤€ë¹„ ----------
    total = result["total"]
    gam = result["ê°"]
    su = result["ìˆ˜"]
    seong = result["ì„±"]
    mental = result["ì •ì‹ "]

    # ì •ì‹ ì§ˆí™˜ ìƒí™© ì ìˆ˜(ê°/ìˆ˜/ì„± 3ë¬¸í•­ì”©)
    ans = result.get("answers", [])
    if len(ans) >= 27:
        mh_gam = ans[6] + ans[7] + ans[8]        # 7~9ë²ˆ
        mh_su = ans[15] + ans[16] + ans[17]     # 16~18ë²ˆ
        mh_seong = ans[24] + ans[25] + ans[26]  # 25~27ë²ˆ
    else:
        mh_gam = mh_su = mh_seong = 0

    # í™”ë©´ì—ì„œ ë¯¸ë¦¬ ì €ì¥í•´ë‘” í…ìŠ¤íŠ¸ (ë§ˆí¬ë‹¤ìš´ ê¸°í˜¸ ì œê±° + PDFìš© í•œì ì •ë¦¬)
    def clean(text: str) -> str:
        if not text:
            return ""
        text = text.replace("**", "")  # êµµê²Œ ë§ˆí¬ë‹¤ìš´ ì œê±°
        return strip_hanja_for_pdf(text)

    overall_text = clean(result.get("txt_overall", ""))
    mental_text = clean(result.get("txt_mental", ""))
    summary_text = clean(result.get("txt_summary", ""))

    # ---------- 1. ì œëª© ----------
    c.setFont("NanumGothic", 18)
    c.drawString(margin_x, y, "ë‚˜ì˜ ê°Â·ìˆ˜Â·ì„± ì¸ê¶Œê°ìˆ˜ì„±ì€?")
    y -= 10 * mm

    # (ì„ íƒ) ì˜ë¬¸ ë¶€ì œ ì•½ê°„ ì‘ê²Œ
    c.setFont("NanumGothic", 9)
    c.drawString(margin_x, y, "My GamÂ·SuÂ·Seong Human-Rights Sensitivity Profile")
    y -= 8 * mm

    # ---------- 2. ì‘ë‹µ ì¼ì‹œ ----------
    c.setFont("NanumGothic", 9)
    c.drawString(margin_x, y, f"ì‘ë‹µ ì¼ì‹œ: {result.get('time_str', '')}")
    y -= 6 * mm

    # ---------- 3. ì ìˆ˜ í•œ ì¤„ ìš”ì•½ ----------
    c.setFont("NanumGothic", 10)
    score_line = (
        f"ì´ì : {total}ì   |  "
        f"ê°: {gam}ì   ìˆ˜: {su}ì   ì„±: {seong}ì   "
        f"(ì •ì‹ ì§ˆí™˜ ê´€ë ¨: {mental}ì )"
    )
    c.drawString(margin_x, y, score_line)
    y -= 10 * mm

    # ---------- 4. ë ˆì´ë” ì°¨íŠ¸ (ê°€ìš´ë° ì •ë ¬) ----------
    chart_size = 55 * mm
    chart_x = (width - chart_size) / 2      # â­ ê°€ìš´ë° ì •ë ¬
    chart_y_bottom = y - chart_size + 5 * mm

    radar_buf = make_radar_image(gam, su, seong, mh_gam, mh_su, mh_seong)
    radar_img = ImageReader(radar_buf)

    c.drawImage(
        radar_img,
        chart_x,
        chart_y_bottom,
        width=chart_size,
        height=chart_size,
        preserveAspectRatio=True,
        mask="auto",
    )

    # ì°¨íŠ¸ ì•„ë˜ ë³¸ë¬¸ ì‹œì‘ ìœ„ì¹˜ ì‚´ì§ í•˜í–¥ ì¡°ì •
    y = chart_y_bottom - 12 * mm

    # ---------- 5. ë³¸ë¬¸ ì„¹ì…˜(OVERALL / MENTAL / SUMMARY) ----------
    body_font_name = "NanumGothic"
    body_font_size = 9
    line_height = 4 * mm

    # ğŸ‘‰ ì‹¤ì œ ì‚¬ìš© ê°€ëŠ¥í•œ í…ìŠ¤íŠ¸ í­ (ì¢Œìš° ì—¬ë°±ì„ ëº€ ë„ˆë¹„)
    available_width = width - (margin_x * 1.5)

    # ğŸ‘‰ í•œê¸€ 1ê¸€ìì˜ ëŒ€ëµì ì¸ í­
    sample_char = "ê°€"
    char_width = pdfmetrics.stringWidth(sample_char, body_font_name, body_font_size)

    # ğŸ‘‰ í•œ ì¤„ì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆëŠ” ìµœëŒ€ ê¸€ì ìˆ˜ (ì—¬ìœ ë¥¼ ì¡°ê¸ˆ ë¹¼ì¤Œ)
    max_chars_per_line = int(available_width / char_width) - 2
    if max_chars_per_line < 20:
        max_chars_per_line = 20  # ë„ˆë¬´ ì‘ì•„ì§€ì§€ ì•Šë„ë¡ ì•ˆì „ì¥ì¹˜

    def draw_section(title: str, body: str):
        nonlocal y

        # í˜ì´ì§€ í•˜ë‹¨ ì—¬ìœ  ì²´í¬
        if y < margin_y + 30 * mm:
            c.showPage()
            y = height - margin_y
            c.setFont("NanumGothic", 11)

        # ëŒ€ì œëª© ì¶œë ¥
        c.setFont("NanumGothic", 11)
        c.drawString(margin_x, y, title)
        y -= 6 * mm

        # ---- ì—¬ê¸°ì„œ "ì¤‘ê°„ì œëª© + ë³¸ë¬¸" êµ¬ì¡° ë¶„ë¦¬ ----
        # ì›ë³¸ í…ìŠ¤íŠ¸ ì¤„ë‹¨ìœ„ ë¶„í•´
        lines = [ln.strip() for ln in body.splitlines() if ln.strip()]

        if not lines:
            y -= 3 * mm
            return

        # 1ì¤„ì§¸: "ì „ì²´ ì¸ê¶Œê°ìˆ˜ì„± â€“ ì¤‘"
        # 2ì¤„ì§¸: "í•œ ì¤„ ìš”ì•½"
        # 3ì¤„ì§¸ë¶€í„° ì‹¤ì œ ë³¸ë¬¸
        subtitle = lines[0]
        content_lines = lines[1:]

        # 2ì¤„ í˜•íƒœë¼ë©´ í•©ì³ì„œ ì„œë¸Œì œëª© ì²˜ë¦¬
        if len(lines) >= 2 and "í•œ ì¤„ ìš”ì•½" in lines[1]:
            subtitle = f"{lines[0]}  {lines[1]}"   # ì¤‘ê°„ì œëª© í•œ ì¤„ë¡œ ë³‘í•©
            content_lines = lines[2:]             # 3ë²ˆì§¸ ì¤„ë¶€í„° ë³¸ë¬¸ìœ¼ë¡œ

        # --- ì„œë¸Œì œëª© ì¶œë ¥ ---
        c.setFont("NanumGothic", 10)
        c.drawString(margin_x, y, subtitle)
        y -= 5 * mm

        # --- ë³¸ë¬¸ ì¶œë ¥ ì‹œì‘ ---
        c.setFont(body_font_name, body_font_size)
        text = " ".join(content_lines)

        rough_lines = wrap(text, width=max_chars_per_line)

        for rough in rough_lines:
            line = ""
            for ch in rough:
                test = line + ch
                if pdfmetrics.stringWidth(test, body_font_name, body_font_size) <= available_width:
                    line = test
                else:
                    if y < margin_y + 15 * mm:
                        c.showPage()
                        y = height - margin_y
                        c.setFont(body_font_name, body_font_size)
                    c.drawString(margin_x, y, line)
                    y -= line_height
                    line = ch

            if line:
                if y < margin_y + 15 * mm:
                    c.showPage()
                    y = height - margin_y
                    c.setFont(body_font_name, body_font_size)
                c.drawString(margin_x, y, line)
                y -= line_height

        y -= 4 * mm
        
    # 5-1) ì „ì²´ ì¸ê¶Œê°ìˆ˜ì„±
    draw_section("ã€ì „ì²´ ì¸ê¶Œê°ìˆ˜ì„±ã€‘", overall_text)

    # 5-2) ì •ì‹ ì§ˆí™˜ ìˆ˜ìš©ì ê°ìˆ˜ì„±
    draw_section("ã€ì •ì‹ ì§ˆí™˜ ìˆ˜ìš©ì ê°ìˆ˜ì„±ã€‘", mental_text)

    # 5-3) ì¢…í•© ì•ˆë‚´ ë©”ì‹œì§€
    draw_section("ã€ì¢…í•© ì•ˆë‚´ ë©”ì‹œì§€ã€‘", summary_text)

    # ---------- 6. í•˜ë‹¨ ê³ ì§€ë¬¸ ----------
    if y < margin_y + 10 * mm:
        c.showPage()
        y = height - margin_y

    disclaimer = (
        "â€» ë³¸ ê²°ê³¼ì§€ëŠ” ìê°€ì ê²€ìš© ë¹„ì„ìƒÂ·ë¹„ì§„ë‹¨ ìë£Œì´ë©°, "
        "ì¸ì‚¬í‰ê°€Â·ë²•ì  íŒë‹¨ì˜ ê·¼ê±°ë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
    )
    c.setFont("NanumGothic", 8)
    c.drawString(
        margin_x,
        margin_y,
        disclaimer
    )

    c.save()
    pdf_bytes = buffer.getvalue()
    buffer.close()
    return pdf_bytes

# =========================
# ì¸êµ¬í•™ ì •ë³´ â†’ ìˆ«ì ì½”ë“œ ë§¤í•‘
# =========================
AGE_MAP = {
    "20ëŒ€": 1,
    "30ëŒ€": 2,
    "40ëŒ€": 3,
    "50ëŒ€": 4,
    "60ëŒ€ ì´ìƒ": 5,
    "ì‘ë‹µí•˜ì§€ ì•ŠìŒ": 9,
}

GENDER_MAP = {
    "ë‚¨ì„±": 1,
    "ì—¬ì„±": 2,
    "ì‘ë‹µí•˜ì§€ ì•ŠìŒ": 9,
}

CAREER_MAP = {
    "5ë…„ ë¯¸ë§Œ": 1,
    "5~10ë…„ ë¯¸ë§Œ": 2,
    "10~20ë…„ ë¯¸ë§Œ": 3,
    "20ë…„ ì´ìƒ": 4,
}

JOBTYPE_MAP = {
    "ë³´ì•ˆê³¼": 1,
    "ì‚¬íšŒë³µê·€ê³¼": 2,
    "ì˜ë£Œê³¼": 3,
    "ì´ë¬´ê³¼/ì§í›ˆê³¼": 4,
    "ê¸°íƒ€": 9,
}

FACIL_MAP = {
    "êµë„ì†Œ": 1,
    "êµ¬ì¹˜ì†Œ": 2,
    "ì†Œë…„ì‹œì„¤": 3,
    "ì¹˜ë£Œê°í˜¸/ì˜ë£Œ": 4,
    "ê¸°íƒ€": 9,
}

SHIFT_MAP = {
    "ì£¼ê°„ ì¤‘ì‹¬": 1,
    "êµëŒ€(ì•¼ê°„ í¬í•¨)": 2,
    "í˜¼í•©/ë¶ˆê·œì¹™": 3,
}

EDU_HR_MAP = {
    "ì „í˜€ ì—†ìŒ": 0,
    "1íšŒ": 1,
    "2~3íšŒ": 2,
    "4íšŒ ì´ìƒ": 3,
}

EDU_MENTAL_MAP = {
    "ì—†ë‹¤": 0,
    "1íšŒ": 1,
    "2íšŒ ì´ìƒ": 2,
}

EXPOSURE_MAP = {
    "ê±°ì˜ ì—†ìŒ": 0,
    "ê°€ë”": 1,
    "ìì£¼": 2,
    "ë§¤ìš° ìì£¼": 3,
}

DEGREE_MAP = {
    "ê³ ì¡¸": 1,
    "ì „ë¬¸ëŒ€": 2,
    "í•™ì‚¬": 3,
    "ì„ì‚¬ ì´ìƒ": 4,
    "ì‘ë‹µí•˜ì§€ ì•ŠìŒ": 9,
}

# =========================
# Google Sheets ì €ì¥
# =========================
SPREADSHEET_KEY = "12l-MzIhszbWb5kV3muWyGoqyfBaKD4CARjqKktndiAg"

def save(row):
    scope = ["https://www.googleapis.com/auth/spreadsheets"]
    creds = Credentials.from_service_account_info(
        st.secrets["gcp_service_account"], scopes=scope)
    client = gspread.authorize(creds)

    sh = client.open_by_key(SPREADSHEET_KEY)
    sheet = sh.worksheet("sheet1")
    sheet.append_row(list(row.values()))

def save_phone(phone):
    """ì»¤í”¼ ì¿ í° ë°œì†¡ì„ ìœ„í•œ íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ë³„ë„ ì‹œíŠ¸ì— ì €ì¥"""
    if not phone:
        return

    scope = ["https://www.googleapis.com/auth/spreadsheets"]
    creds = Credentials.from_service_account_info(
        st.secrets["gcp_service_account"], scopes=scope
    )
    client = gspread.authorize(creds)

    sh = client.open_by_key(SPREADSHEET_KEY)
    # ğŸ“Œ ë¯¸ë¦¬ êµ¬ê¸€ì‹œíŠ¸ ì•ˆì— 'phone' ì´ë¼ëŠ” ì›Œí¬ì‹œíŠ¸ ë§Œë“¤ì–´ ë‘ì„¸ìš”.
    sheet = sh.worksheet("phone")   # â† ì´ ì¤„ ì¶”ê°€
    sheet.append_row([
        datetime.now(ZoneInfo("Asia/Seoul")).strftime("%Y-%m-%d %H:%M:%S"),
        phone,
    ])

def save_feedback(feedback_text: str):
    """ì„¤ë¬¸ í›„ ì‘ë‹µìì˜ ììœ  ì˜ê²¬ì„ ë³„ë„ ì‹œíŠ¸ì— ì €ì¥"""
    if not feedback_text or not feedback_text.strip():
        return

    scope = ["https://www.googleapis.com/auth/spreadsheets"]
    creds = Credentials.from_service_account_info(
        st.secrets["gcp_service_account"], scopes=scope
    )
    client = gspread.authorize(creds)

    sh = client.open_by_key(SPREADSHEET_KEY)
    # ğŸ“Œ êµ¬ê¸€ ì‹œíŠ¸ ì•ˆì— 'feedback' ì´ë¼ëŠ” ì›Œí¬ì‹œíŠ¸ë¥¼ ë¯¸ë¦¬ ë§Œë“¤ì–´ ë‘ì„¸ìš”.
    sheet = sh.worksheet("feedback")
    sheet.append_row([
        datetime.now(ZoneInfo("Asia/Seoul")).strftime("%Y-%m-%d %H:%M:%S"),
        feedback_text,
    ])

# =========================================================
#                  â˜… 0. í‘œì§€ í™”ë©´ â˜…
# =========================================================
if st.session_state.page == "cover":
    st.title("ë‚˜ì˜ ì¸ê¶Œê°ìˆ˜ì„± ì ìˆ˜ëŠ”?")
    st.subheader("ê°Â·ìˆ˜Â·ì„± ì¸ê¶Œê°ìˆ˜ì„± ì‹¤ì²œêµ¬ì¡°ë¥¼ í™•ì¸í•´ ë³´ì")

    st.markdown("""
ì´ ì„¤ë¬¸ì€ **ê°ì •(æ„Ÿ) â€“ ê¸°ì¤€(å—) â€“ ì„±ì°°(æ€§)**ì˜ ìƒí˜¸ì‘ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ  
êµë„ê´€ì´ í˜„ì¥ì—ì„œ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ì¸ê¶Œ ê´€ë ¨ ìƒí™©ì„ íŒë‹¨í•˜ëŠ”ì§€ ì‚´í´ë³´ê¸° ìœ„í•œ ë„êµ¬ì…ë‹ˆë‹¤.

ë‹¹ì‹ ì˜ ì‘ë‹µì€ ë‹¤ìŒê³¼ ê°™ì€ ì—°êµ¬ì— í™œìš©ë©ë‹ˆë‹¤.

- ê°Â·ìˆ˜Â·ì„± ì¸ê¶Œê°ìˆ˜ì„± ì§€í‘œì˜ êµ¬ì¡° í™•ì¸
- ìš”ì†Œ ê°„ ê´€ê³„ ê²€ì¦(CFAÂ·ìƒê´€ ë¶„ì„)
- ì •ì‹ ê±´ê°• ë¬¸ì œê°€ ìˆëŠ” ìˆ˜ìš©ì ë¬¸í•­ì˜ ë¯¼ê°ë„ í‰ê°€

ì´ ì„¤ë¬¸ì€ ê°œì¸ì„ í‰ê°€í•˜ê¸° ìœ„í•œ ê²ƒì´ ì•„ë‹ˆë¼,  
**êµì •í˜„ì¥ì˜ íŒë‹¨ êµ¬ì¡°ë¥¼ ì´í•´í•˜ê³  ì‹¤ì²œ ê°€ëŠ¥í•œ ì¸ê¶Œê°ìˆ˜ì„± ì§€í‘œë¥¼ ê°œë°œí•˜ê¸° ìœ„í•œ ì—°êµ¬ ë„êµ¬**ì…ë‹ˆë‹¤.

---

### ğŸ§­ ì´ ì„¤ë¬¸ì˜ ê²°ê³¼ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆëŠ” ê²ƒ

- ì¸ê¶Œì´ ë¬¸ì œë˜ëŠ” ìƒí™©ì„ ë‚˜ëŠ” ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ íŒë‹¨í•˜ëŠ”ê°€?
- ë‚˜ì˜ **ê°ì •Â·ê¸°ì¤€Â·ì„±ì°°ì´ ì–´ë–¤ ê´€ê³„ êµ¬ì¡°**ë¡œ ì‘ë™í•˜ëŠ”ê°€?
- **ì •ì‹ ê±´ê°• ë¬¸ì œê°€ ìˆëŠ” ìˆ˜ìš©ì**ë¥¼ ëŒ€í•  ë•Œ ë‚˜ì˜ ê°ìˆ˜ì„± êµ¬ì¡°ëŠ” ì–´ë–»ê²Œ ë‹¬ë¼ì§€ëŠ”ê°€?

---

### ğŸ”’ ë³¸ ì„¤ë¬¸ì€ ì•ˆì „í•˜ê³  ìµëª…ìœ¼ë¡œ ì§„í–‰

- ì¸ì‚¬í‰ê°€ì™€ ë¬´ê´€í•©ë‹ˆë‹¤.
- ì´ë¦„Â·ì†Œì† ë“± ê°œì¸ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- ëª¨ë“  ì‘ë‹µì€ ìµëª… ì²˜ë¦¬ë˜ë©° ê²°ê³¼ëŠ” ì¦‰ì‹œ í™”ë©´ì—ì„œë§Œ í™•ì¸ë©ë‹ˆë‹¤.
- ì ìˆ˜ëŠ” í‰ê°€ê°€ ì•„ë‹ˆë¼, **ë‚˜ì˜ íŒë‹¨ ì‘ë™ ë°©ì‹ì„ ì´í•´í•˜ê¸° ìœ„í•œ ì°¸ê³  ì •ë³´**ì…ë‹ˆë‹¤.

---

### â± ì˜ˆìƒ ì†Œìš”ì‹œê°„: ì•½ 8~10ë¶„

ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì„¤ë¬¸ì„ ì‹œì‘í•´ ì£¼ì„¸ìš”.
""")

    if st.button("ì„¤ë¬¸ ì‹œì‘í•˜ê¸°"):
        st.session_state.page = "consent"
        st.rerun()

    st.stop()

# =========================================================
#                  â˜… 1. ì—°êµ¬ ì°¸ì—¬ ë™ì˜ â˜…
# =========================================================
if st.session_state.page == "consent":
    st.header("ì—°êµ¬ì°¸ì—¬ ë™ì˜ì„œ")
    st.markdown("""
ë³¸ ì„¤ë¬¸ì€ êµì • í˜„ì¥ì—ì„œ ê·¼ë¬´í•˜ëŠ” êµë„ê´€ì˜  
ì¸ê¶Œê°ìˆ˜ì„± êµ¬ì¡°ë¥¼ íƒìƒ‰í•˜ê¸° ìœ„í•œ ì—°êµ¬ì…ë‹ˆë‹¤.

- ìµëª… ì„¤ë¬¸ì´ë©° ì¸ì‚¬í‰ê°€ì™€ ì „í˜€ ë¬´ê´€í•©ë‹ˆë‹¤.  
- ì‘ë‹µì€ ì—°êµ¬ ëª©ì ì— í•œí•´ ì‚¬ìš©ë©ë‹ˆë‹¤.  
""")

    agree = st.checkbox("ìœ„ ë‚´ìš©ì„ ì´í•´í•˜ê³  ì—°êµ¬ ì°¸ì—¬ì— ë™ì˜í•©ë‹ˆë‹¤.")

    if not agree:
        st.warning("ë™ì˜í•´ì•¼ ì„¤ë¬¸ì„ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.")
        st.stop()

    if st.button("ì„¤ë¬¸ìœ¼ë¡œ ì´ë™"):
        st.session_state.page = "survey"
        st.rerun()

    st.stop()

# =========================================================
#                  â˜… 2. ì„¤ë¬¸ í™”ë©´ â˜…
# =========================================================
if st.session_state.page == "survey":

    st.title("ì¸ê¶Œê°ìˆ˜ì„± ì„¤ë¬¸ (27ë¬¸í•­)")
    st.caption("â€» ìµœê·¼ ê·¼ë¬´ ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ ì‘ë‹µí•´ ì£¼ì„¸ìš”.")

    # ğŸ‘‰ ìˆ«ì ë¼ë””ì˜¤ ë²„íŠ¼ë§Œ ì •ë ¬
    st.markdown("""
    <style>
    .stRadio > div {
        display: flex !important;
        justify-content: center !important;
        gap: 18px !important;
        margin: 6px 0 12px 0 !important;
    }
    @media (max-width: 480px) {
        .stRadio > div {
            gap: 12px !important;
        }
    }
    </style>
    """, unsafe_allow_html=True)

    # ğŸ”´ ìƒë‹¨ ì•ˆë‚´
    st.markdown(
        """
        <p style="color:red; font-weight:700; text-decoration:underline; font-size:1.1rem;">
        ìµœê·¼ 6ê°œì›”ê°„ ê·¼ë¬´ ê²½í—˜ì„ ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.
        </p>
        """,
        unsafe_allow_html=True,
    )

    # ğŸ“Œ ì‘ë‹µ ê¸°ì¤€ ì•ˆë‚´ (ìˆ«ìë§Œ ì‚¬ìš©)
    st.markdown(
        """
        ë³¸ ì„¤ë¬¸ì€ **4ì  ì²™ë„**ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.

        - **1ì :** ì „í˜€ ê·¸ë ‡ì§€ ì•Šë‹¤  
        - **2ì :** ê·¸ë ‡ì§€ ì•Šì€ í¸ì´ë‹¤  
        - **3ì :** ê·¸ë ‡ë‹¤  
        - **4ì :** ë§¤ìš° ê·¸ë ‡ë‹¤  

        ê° ë¬¸í•­ì— ëŒ€í•´ ê°€ì¥ ê°€ê¹Œìš´ ì ìˆ˜ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.
        """,
        unsafe_allow_html=True,
    )

    st.write("")  # ê°„ê²©
    answers = []

    # =========================
    # ë¬¸í•­ ë£¨í”„  (â€» ë°˜ë“œì‹œ if ë‚´ë¶€)
    # =========================
    for i, q in enumerate(QUESTIONS, 1):

        # ì´ì „ ë¬¸í•­ ì‘ë‹µí•´ì•¼ ë‹¤ìŒ í™œì„±í™”
        disabled = False if i == 1 else (st.session_state.get(f"q_{i-1}") is None)

        # ì§ˆë¬¸ í‘œì‹œ
        st.markdown(
            f"<div style='font-weight:600; font-size:1rem; margin-bottom:6px;'>{i}. {q}</div>",
            unsafe_allow_html=True
        )

        # ìˆ«ìë§Œ ì¤‘ì•™
        col_left, col_center, col_right = st.columns([1, 2, 1])
        with col_center:
            ans = st.radio(
                "",
                [1, 2, 3, 4],
                horizontal=True,
                index=None,
                key=f"q_{i}",
                disabled=disabled,
                label_visibility="collapsed",
            )

        answers.append(ans)
        if ans is not None:
            st.session_state.answers[i] = ans

        st.markdown("<hr style='margin:10px 0;'>", unsafe_allow_html=True)

    # =========================
    # ì œì¶œ ë²„íŠ¼ (â€» for ë£¨í”„ ë°”ê¹¥)
    # =========================
    can_submit = all(st.session_state.get(f"q_{i}") is not None for i in range(1, 28))

    submit = st.button("ë‹¤ìŒ", key="survey_next_btn", disabled=not can_submit)

    if submit:
        answers = [st.session_state.get(f"q_{i}") for i in range(1, 28)]
        total = sum(answers)
        ê° = sum(answers[0:9])
        ìˆ˜ = sum(answers[9:18])
        ì„± = sum(answers[18:27])
        mh_items = [7, 8, 9, 16, 17, 18, 25, 26, 27]
        mh_score = sum(answers[i - 1] for i in mh_items)

        st.session_state.result = {
            "total": total,
            "ê°": ê°,
            "ìˆ˜": ìˆ˜,
            "ì„±": ì„±,
            "ì •ì‹ ": mh_score,
            "answers": answers
        }

        st.session_state.page = "demographic"
        st.rerun()

# =========================================================
#          â˜… 3. ì¸êµ¬í•™ì  ì •ë³´ (ì„ íƒ í•­ëª©) í˜ì´ì§€ â˜…
# =========================================================
if st.session_state.page == "demographic":

    # ===== ìŠ¤íƒ€ì¼ ë³´ì • CSS =====
    st.markdown("""
    <style>
    .question-label {
        font-size: 1.15rem !important;
        font-weight: 700 !important;
        color: #111827 !important;
        margin-top: 18px !important;
        margin-bottom: 6px !important;
        display: block;
        line-height: 1.45;
    }
    .stRadio > div > label, .stRadio label {
        font-size: 1.05rem !important;
        color: #111 !important;
    }
    @media (max-width: 480px) {
        .question-label {
            font-size: 1.05rem !important;
        }
        .stRadio label {
            font-size: 1rem !important;
        }
    }
    </style>
    """, unsafe_allow_html=True)

    # ğŸ‘‰ í˜ì´ì§€ ì§„ì…í•  ë•Œë§ˆë‹¤ í™”ë©´ ë§¨ ìœ„ë¡œ ì´ë™ (ê°„ë‹¨ ë²„ì „)
    components.html(
        "<script>window.scrollTo(0, 0);</script>",
        height=0,
    )

    # ===== ì œëª© =====
    st.header("ğŸ“Œ ì¸êµ¬í•™ì  ì •ë³´")
    st.caption("â€» ì„ íƒ ì‘ë‹µ, ìµëª… ì²˜ë¦¬ / ì—°êµ¬ ëª©ì  ì™¸ ì‚¬ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.")

    # ===== ë¬¸í•­ =====
    st.markdown('<span class="question-label">1. ì—°ë ¹ëŒ€</span>', unsafe_allow_html=True)
    age = st.radio("", ["20ëŒ€","30ëŒ€","40ëŒ€","50ëŒ€","60ëŒ€ ì´ìƒ","ì‘ë‹µí•˜ì§€ ì•ŠìŒ"], key="age", index=None)

    st.markdown('<span class="question-label">2. ì„±ë³„</span>', unsafe_allow_html=True)
    gender = st.radio("", ["ë‚¨ì„±","ì—¬ì„±","ì‘ë‹µí•˜ì§€ ì•ŠìŒ"], key="gender", index=None,
                      disabled=(age is None))

    st.markdown('<span class="question-label">3. êµì • ê²½ë ¥</span>', unsafe_allow_html=True)
    career = st.radio("", ["5ë…„ ë¯¸ë§Œ","5~10ë…„ ë¯¸ë§Œ","10~20ë…„ ë¯¸ë§Œ","20ë…„ ì´ìƒ"], key="career", index=None,
                      disabled=(gender is None))

    st.markdown('<span class="question-label">4. ê·¼ë¬´ ìœ í˜•</span>', unsafe_allow_html=True)
    jobtype = st.radio("", ["ë³´ì•ˆê³¼","ì‚¬íšŒë³µê·€ê³¼","ì˜ë£Œê³¼","ì´ë¬´ê³¼/ì§í›ˆê³¼","ê¸°íƒ€"], key="jobtype", index=None,
                       disabled=(career is None))

    st.markdown('<span class="question-label">5. ê·¼ë¬´ ê¸°ê´€</span>', unsafe_allow_html=True)
    facil = st.radio("", ["êµë„ì†Œ","êµ¬ì¹˜ì†Œ","ì†Œë…„ì‹œì„¤","ì¹˜ë£Œê°í˜¸/ì˜ë£Œ","ê¸°íƒ€"], key="facil", index=None,
                     disabled=(jobtype is None))

    st.markdown('<span class="question-label">6. êµëŒ€ í˜•íƒœ</span>', unsafe_allow_html=True)
    shift = st.radio("", ["ì£¼ê°„ ì¤‘ì‹¬","êµëŒ€(ì•¼ê°„ í¬í•¨)","í˜¼í•©/ë¶ˆê·œì¹™"], key="shift", index=None,
                     disabled=(facil is None))

    st.markdown('<span class="question-label">7. ì¸ê¶Œ ê´€ë ¨ êµìœ¡ ê²½í—˜(ìµœê·¼ 3ë…„)</span>', unsafe_allow_html=True)
    edu_hr = st.radio("", ["ì „í˜€ ì—†ìŒ","1íšŒ","2~3íšŒ","4íšŒ ì´ìƒ"], key="edu_hr", index=None,
                      disabled=(shift is None))

    st.markdown('<span class="question-label">8. ì •ì‹ ì§ˆí™˜ ê´€ë ¨ êµìœ¡ ê²½í—˜</span>', unsafe_allow_html=True)
    edu_mental = st.radio("", ["ì—†ë‹¤","1íšŒ","2íšŒ ì´ìƒ"], key="edu_mental", index=None,
                          disabled=(edu_hr is None))

    st.markdown('<span class="question-label">9. ì •ì‹ ì§ˆí™˜ ìˆ˜ìš©ì ëŒ€ë©´ ë¹ˆë„</span>', unsafe_allow_html=True)
    exposure = st.radio("", ["ê±°ì˜ ì—†ìŒ","ê°€ë”","ìì£¼","ë§¤ìš° ìì£¼"], key="exposure", index=None,
                        disabled=(edu_mental is None))

    st.markdown('<span class="question-label">10. ìµœì¢… í•™ë ¥</span>', unsafe_allow_html=True)
    degree = st.radio("", ["ê³ ì¡¸","ì „ë¬¸ëŒ€","í•™ì‚¬","ì„ì‚¬ ì´ìƒ","ì‘ë‹µí•˜ì§€ ì•ŠìŒ"], key="degree", index=None,
                      disabled=(exposure is None))

    # ===== ì¿ í° =====
    st.markdown("---")
    st.markdown("### â˜• ì»¤í”¼ ì¿ í° ìˆ˜ë ¹ (ì„ íƒ)")
    want_coupon = st.checkbox("ì»¤í”¼ ì¿ í°ì„ ë°›ê¸° ìœ„í•´ íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ê² ìŠµë‹ˆë‹¤. ìˆ˜ì§‘ëœ ë²ˆí˜¸ëŠ” ë³¸ ì—°êµ¬ì™€ ë¶„ë¦¬ì €ì¥ë˜ê³  ì¿ í°ë°œì†¡ í›„ ì¦‰ì‹œ íê¸°í•©ë‹ˆë‹¤.", key="want_coupon")

    if want_coupon:
        st.text_input("íœ´ëŒ€í° ë²ˆí˜¸ ì…ë ¥ (ì˜ˆ: 01012345678)", key="phone_input")
        st.caption("â€» '-' ì—†ì´ ìˆ«ìë§Œ ì…ë ¥ / ì¿ í° ë°œì†¡ ì „ìš© ì €ì¥")

    # ===== ì œì¶œ ì¡°ê±´ =====
    demo_keys = ["age","gender","career","jobtype","facil","shift","edu_hr","edu_mental","exposure","degree"]
    base_filled = all(st.session_state.get(k) is not None for k in demo_keys)
    phone_filled = bool(st.session_state.get("phone_input", "").strip())
    can_next = base_filled and (not want_coupon or phone_filled)

    # ===== ë‹¤ìŒ ë²„íŠ¼ =====
    if st.button("ë‹¤ìŒ (ê²°ê³¼ ë³´ê¸°)", disabled=not can_next):
        st.session_state.demographic = {
            "ì—°ë ¹ëŒ€": age, "ì„±ë³„": gender, "ê²½ë ¥": career, "ì§ë¬´": jobtype, "ê¸°ê´€": facil,
            "êµëŒ€": shift, "ì¸ê¶Œêµìœ¡": edu_hr, "ì •ì‹ êµìœ¡": edu_mental,
            "ëŒ€ë©´ë¹ˆë„": exposure, "í•™ë ¥": degree
        }
        st.session_state["phone"] = st.session_state.get("phone_input", "").strip() if want_coupon else None
        st.session_state.page = "result"
        st.rerun()
        
# =========================================================
#                  â˜… 3. ê²°ê³¼ í™”ë©´ â˜…
# =========================================================
import time
import streamlit.components.v1 as components
import plotly.graph_objects as go

if st.session_state.page == "result":

    # ğŸ‘‰ ê²°ê³¼ í˜ì´ì§€ ì§„ì… ì‹œ í•­ìƒ ë§¨ ìœ„ë¡œ ìŠ¤í¬ë¡¤
    components.html(
        "<script>window.scrollTo(0, 0);</script>",
        height=0,
    )

    # 2) ê²°ê³¼ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    r = st.session_state.get("result", None)
    if r is None:
        st.warning("ê²°ê³¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ì„¤ë¬¸ì„ ë‹¤ì‹œ ì§„í–‰í•´ì£¼ì„¸ìš”.")
        st.stop()

    total = r["total"]
    gam = r["ê°"]
    su = r["ìˆ˜"]
    seong = r["ì„±"]
    mental = r["ì •ì‹ "]

    # 3) ì ìˆ˜ ìš”ì•½
    st.title("ğŸ“Š ì¸ê¶Œê°ìˆ˜ì„± ê²°ê³¼ ìš”ì•½")
    st.write(f"ì´ì : **{total}ì **")
    st.write(f"ê°: **{gam}ì ** / ìˆ˜: **{su}ì ** / ì„±: **{seong}ì **")
    st.write(f"ì •ì‹ ì§ˆí™˜ ê´€ë ¨ ì ìˆ˜: **{mental}ì **")

    # 4) ë ˆì´ë” ì°¨íŠ¸ (ì œì¶œ í›„ ê²°ê³¼ í™”ë©´ì—ì„œ í•­ìƒ ë Œë”)
    st.subheader("ğŸ•¸ ê°Â·ìˆ˜Â·ì„± ì¸ê¶Œê°ìˆ˜ì„± í”„ë¡œíŒŒì¼ (Radar Chart)")

    categories = ["ê°", "ìˆ˜", "ì„±"]
    values_total = [gam, su, seong]

    # ì •ì‹ ì§ˆí™˜ ìƒí™© ì ìˆ˜ â€” ê°Â·ìˆ˜Â·ì„±ë³„ 3ë¬¸í•­ì”© ìë™ ë¶„ë¦¬
    mh_gam = sum([r['answers'][6], r['answers'][7], r['answers'][8]])      # 7~9ë²ˆ
    mh_su = sum([r['answers'][15], r['answers'][16], r['answers'][17]])    # 16~18ë²ˆ
    mh_seong = sum([r['answers'][24], r['answers'][25], r['answers'][26]]) # 25~27ë²ˆ
    values_mh = [mh_gam, mh_su, mh_seong]

    fig = go.Figure()

    fig.add_trace(go.Scatterpolar(
        r=values_total,
        theta=categories,
        fill='toself',
        name='ì „ì²´ ì ìˆ˜',
        line=dict(color='blue')
    ))

    fig.add_trace(go.Scatterpolar(
        r=values_mh,
        theta=categories,
        fill='toself',
        name='ì •ì‹ ì§ˆí™˜ ìƒí™© ì ìˆ˜',
        line=dict(color='red')
    ))

    fig.update_layout(
        polar=dict(
            radialaxis=dict(visible=True, range=[0, 36])
        ),
        showlegend=True,
        title="ê°Â·ìˆ˜Â·ì„± ì¸ê¶Œê°ìˆ˜ì„± í”„ë¡œíŒŒì¼"
    )

    st.plotly_chart(fig, use_container_width=True)

    # 5) í”¼ë“œë°±
    st.subheader("ğŸ“ ê°œì¸ ë§ì¶¤í˜• í”¼ë“œë°±")

    # ---- ì ìˆ˜ ìˆ˜ì¤€ ê³„ì‚° ----
    overall_lv = overall_level(total)
    gam_lv = subfactor_level(gam)
    su_lv = subfactor_level(su)
    seong_lv = subfactor_level(seong)
    mental_lv = mental_level(mental)

    pattern_key = detect_pattern(gam_lv, su_lv, seong_lv)

    # ğŸ‘‰ PDFìš©: í™”ë©´ì—ì„œ ì‚¬ìš©í•œ í•´ì„ í…ìŠ¤íŠ¸ë¥¼ ê·¸ëŒ€ë¡œ ì €ì¥
    st.session_state.result["txt_overall"] = OVERALL_TEXT[overall_lv]
    st.session_state.result["txt_emotion"] = EMOTION_TEXT[gam_lv]
    st.session_state.result["txt_norm"] = NORM_TEXT[su_lv]
    st.session_state.result["txt_reflect"] = REFLECT_TEXT[seong_lv]
    st.session_state.result["txt_pattern"] = PATTERN_TEXT[pattern_key]
    st.session_state.result["txt_mental"] = MENTAL_TEXT[mental_lv]
    st.session_state.result["txt_summary"] = SUMMARY_MESSAGE

    # ---- 1) ì „ì²´ ì ìˆ˜ ----
    st.markdown("### ğŸ”¹ 1) ì „ì²´ ê°Â·ìˆ˜Â·ì„± ì¸ê¶Œê°ìˆ˜ì„±")
    st.caption(f"í˜„ì¬ ì „ì²´ ì ìˆ˜ ìˆ˜ì¤€: **{LEVEL_LABEL_KO[overall_lv]}**")
    st.write(OVERALL_TEXT[overall_lv])

    # ---- 2) ê° / ìˆ˜ / ì„± í•˜ìœ„ìš”ì¸ ----
    st.markdown("### ğŸ”¹ 2) í•˜ìœ„ìš”ì¸ë³„ ê°Â·ìˆ˜Â·ì„± í•´ì„")

    st.write(f"#### ê°(æ„Ÿ) â€“ {LEVEL_LABEL_KO[gam_lv]} ìˆ˜ì¤€")
    st.write(EMOTION_TEXT[gam_lv])

    st.write(f"#### ìˆ˜(å—) â€“ {LEVEL_LABEL_KO[su_lv]} ìˆ˜ì¤€")
    st.write(NORM_TEXT[su_lv])

    st.write(f"#### ì„±(æ€§) â€“ {LEVEL_LABEL_KO[seong_lv]} ìˆ˜ì¤€")
    st.write(REFLECT_TEXT[seong_lv])

    # ---- 3) ê°Â·ìˆ˜Â·ì„± ì¡°í•©/íŒ¨í„´ ----
    st.markdown("### ğŸ”¹ 3) ê°Â·ìˆ˜Â·ì„± ì¡°í•©/íŒ¨í„´ í•´ì„")
    st.caption(f"ê°={LEVEL_LABEL_KO[gam_lv]}, ìˆ˜={LEVEL_LABEL_KO[su_lv]}, ì„±={LEVEL_LABEL_KO[seong_lv]}")
    st.write(PATTERN_TEXT[pattern_key])

    # ---- 4) ì •ì‹ ì§ˆí™˜ ìˆ˜ìš©ì ê´€ë ¨ ê°ìˆ˜ì„± ----
    st.markdown("### ğŸ”¹ 4) ì •ì‹ ì§ˆí™˜ ìˆ˜ìš©ì ê´€ë ¨ ê°ìˆ˜ì„±")
    st.caption(f"ì •ì‹ ì§ˆí™˜ ìˆ˜ìš©ì ê´€ë ¨ ì ìˆ˜ ìˆ˜ì¤€: **{LEVEL_LABEL_KO[mental_lv]}**")
    st.write(MENTAL_TEXT[mental_lv])

    # ---- 5) ê³µí†µ ì¢…í•© ë©”ì‹œì§€ ----
    st.markdown("### ğŸ”¹ 5) ì¢…í•© ì•ˆë‚´ ë©”ì‹œì§€")
    st.write(SUMMARY_MESSAGE)

    # ğŸ” ì•ˆì „í•œ í•´ì„ì„ ìœ„í•œ ê³ ì§€ë¬¸ (ë¹„ì§„ë‹¨Â·ë¹„í‰ê°€ ì„ ì–¸)
    st.markdown("""
    ---
    ### ğŸ”’ ì•ˆì „í•œ í•´ì„ì„ ìœ„í•œ ê³ ì§€ë¬¸
    ë³¸ ê²°ê³¼ëŠ” **ìê°€ì ê²€ìš©Â·ë¹„ì„ìƒÂ·ë¹„ì§„ë‹¨ ë„êµ¬**ì´ë©°,
    ê°œì¸ì˜ ì„±í–¥Â·ì—­ëŸ‰Â·ì í•©ì„±ì„ íŒì •í•˜ê±°ë‚˜ í‰ê°€í•˜ê¸° ìœ„í•œ ëª©ì ì´ ì•„ë‹™ë‹ˆë‹¤.

    ê°’ì˜ ì°¨ì´ëŠ” ê°œì¸ì˜ ë¬¸ì œê°€ ì•„ë‹ˆë¼,
    **ì—…ë¬´ ì¡°ê±´Â·ì •ì„œ ìì›Â·ì¡°ì§ ì—¬ê±´Â·ì‚¬ê±´ ì••ë ¥**ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

    â€» ë²•ì Â·í–‰ì •ì  íŒë‹¨, ì¸ì‚¬í‰ê°€, ê¸°ì§ˆ/ë³‘ë¦¬ ì¶”ì •ì— ì‚¬ìš©ë  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
    """)

    # --- ì„¤ë¬¸ì— ëŒ€í•œ ììœ  ì˜ê²¬ ì…ë ¥ (ì„ íƒ) ---
    st.markdown("---")
    st.subheader("ğŸ—£ ì„¤ë¬¸ì— ëŒ€í•œ ì˜ê²¬ (ì„ íƒ)")

    st.caption("ë¬¸í•­ êµ¬ì„±, ê¸¸ì´, í‘œí˜„, ê²°ê³¼ì§€ ë‚´ìš©, ì „ë°˜ì ì¸ ëŠë‚Œ, ê°œì„ ì  ë“±ì— ëŒ€í•´ ììœ ë¡­ê²Œ ì ì–´ ì£¼ì„¸ìš”.")
    st.caption("â€» ì…ë ¥ì€ ì„ íƒ ì‚¬í•­ì…ë‹ˆë‹¤. ì ì§€ ì•Šì•„ë„ ì„¤ë¬¸ ì œì¶œì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.")

    feedback_text = st.text_area(
        "ììœ  ì˜ê²¬",
        key="survey_feedback",
        height=120,
        placeholder="ì˜ˆ) ë¬¸í•­ì´ ì¡°ê¸ˆ ê¸¸ê²Œ ëŠê»´ì¡ŒìŠµë‹ˆë‹¤.\nì •ì‹ ì§ˆí™˜ ê´€ë ¨ ë¬¸í•­ì´ ì¸ìƒ ê¹Šì—ˆìŠµë‹ˆë‹¤.\nì–´ë ¤ì› ë˜ ì ì´ë‚˜ ì¢‹ì•˜ë˜ ì ì„ ì ì–´ ì£¼ì„¸ìš”."
    )

    # ---- ê²°ê³¼ì§€ PDF ìƒì„± & ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ----
    st.session_state.result["time_str"] = datetime.now(ZoneInfo("Asia/Seoul")).strftime("%Y-%m-%d %H:%M:%S")

    pdf_bytes = make_result_pdf(
        st.session_state.result,
        st.session_state.get("demographic", {})
    )

    st.download_button(
        label="ğŸ“„ ê²°ê³¼ì§€ PDF ë‹¤ìš´ë¡œë“œ",
        data=pdf_bytes,
        file_name="ë‚˜ì˜_ê°ìˆ˜ì„±_ì¸ê¶Œê°ìˆ˜ì„±_ê²°ê³¼ì§€.pdf",
        mime="application/pdf",
    )

    st.markdown("---")

    # âœ… ì—¬ê¸°ì„œ í•œ ë²ˆì— ì„¤ë¬¸ ì¢…ë£Œ + ì €ì¥ + (ìˆë‹¤ë©´) ì˜ê²¬ ì €ì¥
    if st.button("âœ… ì„¤ë¬¸ ì¢…ë£Œ ë° ì œì¶œ", key="final_submit"):

        if not st.session_state.get("saved_to_sheet", False):

            # 1) ê¸°ë³¸ ì‘ë‹µ ì €ì¥ìš© row êµ¬ì„±
            row = {
                "time": datetime.now(ZoneInfo("Asia/Seoul")).strftime("%Y-%m-%d %H:%M:%S"),
                "total": total,
                "ê°": gam,
                "ìˆ˜": su,
                "ì„±": seong,
                "ì •ì‹ ": mental,
            }
            # ì„¤ë¬¸ 27ë¬¸í•­ ì ìˆ˜
            for i, a in enumerate(r["answers"], 1):
                row[f"q{i}"] = a

            # ğŸ“Š ì¸êµ¬í•™ ì •ë³´ ìˆ«ì ì½”ë“œë¡œ ë³€í™˜
            demo = st.session_state.get("demographic", {})

            row["ì—°ë ¹ëŒ€"]   = AGE_MAP.get(demo.get("ì—°ë ¹ëŒ€"))
            row["ì„±ë³„"]     = GENDER_MAP.get(demo.get("ì„±ë³„"))
            row["ê²½ë ¥"]     = CAREER_MAP.get(demo.get("ê²½ë ¥"))
            row["ì§ë¬´"]     = JOBTYPE_MAP.get(demo.get("ì§ë¬´"))
            row["ê¸°ê´€"]     = FACIL_MAP.get(demo.get("ê¸°ê´€"))
            row["êµëŒ€"]     = SHIFT_MAP.get(demo.get("êµëŒ€"))
            row["ì¸ê¶Œêµìœ¡"] = EDU_HR_MAP.get(demo.get("ì¸ê¶Œêµìœ¡"))
            row["ì •ì‹ êµìœ¡"] = EDU_MENTAL_MAP.get(demo.get("ì •ì‹ êµìœ¡"))
            row["ëŒ€ë©´ë¹ˆë„"] = EXPOSURE_MAP.get(demo.get("ëŒ€ë©´ë¹ˆë„"))
            row["í•™ë ¥"]     = DEGREE_MAP.get(demo.get("í•™ë ¥"))

            # â˜• ì»¤í”¼ ì¿ í°ìš© íœ´ëŒ€í° ë²ˆí˜¸ ë³„ë„ ì €ì¥
            phone = st.session_state.get("phone", None)
            if phone:
                try:
                    save_phone(phone)
                except Exception as e:
                    st.warning("íœ´ëŒ€í° ë²ˆí˜¸ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì¿ í° ë°œì†¡ì— ë¬¸ì œê°€ ìƒê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.")
                    st.caption(str(e))

            # 2) ë©”ì¸ ì‘ë‹µ ì €ì¥
            try:
                save(row)
                st.session_state.saved_to_sheet = True   # âœ… ì´í›„ì—ëŠ” ë‹¤ì‹œ ì €ì¥ ì•ˆ í•¨
                st.success("ì‘ë‹µì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ì„¤ë¬¸ì— ì°¸ì—¬í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.")
            except Exception as e:
                st.error("ì‘ë‹µ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")
                st.caption(str(e))

            # 3) ì˜ê²¬ì´ ìˆë‹¤ë©´ ë³„ë„ ì‹œíŠ¸ì— ì €ì¥ (ì„ íƒ)
            if feedback_text and feedback_text.strip():
                try:
                    # âš ï¸ ìœ„ìª½ì— save_feedback(feedback_text) í•¨ìˆ˜ê°€ ì •ì˜ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
                    save_feedback(feedback_text.strip())
                    st.info("ì‘ì„±í•´ ì£¼ì‹  ì˜ê²¬ë„ í•¨ê»˜ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.")
                except Exception as e:
                    st.warning("ì˜ê²¬ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (ì„¤ë¬¸ ì‘ë‹µì€ ì •ìƒ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.)")
                    st.caption(str(e))

            st.caption("â€» ë³¸ ì„¤ë¬¸ì€ ì—°êµ¬ ëª©ì ì˜ ìê°€ì ê²€ ë„êµ¬ì´ë©° ì¸ì‚¬í‰ê°€ì™€ ë¬´ê´€í•©ë‹ˆë‹¤.")

        else:
            # ì´ë¯¸ ì €ì¥ëœ ìƒíƒœì—ì„œ ì œì¶œ ë²„íŠ¼ì„ ë‹¤ì‹œ ëˆŒë €ì„ ë•Œ
            st.info("ì´ë¯¸ ì œì¶œëœ ì„¤ë¬¸ì…ë‹ˆë‹¤. ì°¸ì—¬í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.")



































































































































